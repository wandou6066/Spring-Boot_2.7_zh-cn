<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>SpringBoot2.7参考文档</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>SpringBoot2.7参考文档</h1>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_声明">1. 声明</a></li>
<li><a href="#_获取帮助">2. 获取帮助</a></li>
<li><a href="#_文档概述">3. 文档概述</a></li>
<li><a href="#_开始">4. 开始</a>
<ul class="sectlevel2">
<li><a href="#_简单介绍">4.1. 简单介绍</a></li>
<li><a href="#_系统要求">4.2. 系统要求</a>
<ul class="sectlevel3">
<li><a href="#_包含的servlet容器">4.2.1. 包含的servlet容器</a></li>
</ul>
</li>
<li><a href="#_安装springboot">4.3. 安装SpringBoot</a>
<ul class="sectlevel3">
<li><a href="#_java开发工具的安装说明">4.3.1. Java开发工具的安装说明</a></li>
<li><a href="#_安装spring_boot_cli_command_line_interface">4.3.2. 安装Spring Boot CLI  (Command Line Interface)</a></li>
</ul>
</li>
<li><a href="#_开发你的第一个spring_boot应用程序">4.4. 开发你的第一个Spring Boot应用程序</a>
<ul class="sectlevel3">
<li><a href="#_创建pom">4.4.1. 创建pom</a></li>
<li><a href="#_添加classpath依赖项">4.4.2. 添加classpath依赖项</a></li>
<li><a href="#_写代码">4.4.3. 写代码</a></li>
<li><a href="#_运行案例">4.4.4. 运行案例</a></li>
<li><a href="#_创建可执行jar包">4.4.5. 创建可执行jar包</a></li>
</ul>
</li>
<li><a href="#_下一步干啥">4.5. 下一步干啥</a></li>
</ul>
</li>
<li><a href="#_升级springboot">5. 升级SpringBoot</a>
<ul class="sectlevel2">
<li><a href="#_从1_x升级">5.1. 从1.x升级</a></li>
<li><a href="#_升级到新功能版本">5.2. 升级到新功能版本</a></li>
</ul>
</li>
<li><a href="#_使用spring_boot开发">6. 使用Spring Boot开发</a>
<ul class="sectlevel2">
<li><a href="#_依赖管理工具">6.1. 依赖管理工具</a>
<ul class="sectlevel3">
<li><a href="#_maven">6.1.1. Maven</a></li>
<li><a href="#_gradle">6.1.2. Gradle</a></li>
<li><a href="#_ant">6.1.3. Ant</a></li>
<li><a href="#_启动器">6.1.4. 启动器</a></li>
</ul>
</li>
<li><a href="#_写代码_2">6.2. 写代码</a>
<ul class="sectlevel3">
<li><a href="#_使用_default_包">6.2.1. 使用 "default "包</a></li>
<li><a href="#_找到主应用程序类">6.2.2. 找到主应用程序类</a></li>
</ul>
</li>
<li><a href="#_配置类">6.3. 配置类</a>
<ul class="sectlevel3">
<li><a href="#_导入额外的配置类">6.3.1. 导入额外的配置类</a></li>
<li><a href="#_导入xml配置">6.3.2. 导入xml配置</a></li>
</ul>
</li>
<li><a href="#_自动配置">6.4. 自动配置</a>
<ul class="sectlevel3">
<li><a href="#_逐步取代自动配置">6.4.1. 逐步取代自动配置</a></li>
<li><a href="#_禁用特定的自动配置类">6.4.2. 禁用特定的自动配置类</a></li>
</ul>
</li>
<li><a href="#_spring_bean和依赖性注入">6.5. Spring Bean和依赖性注入</a></li>
<li><a href="#_使用springbootapplication_注解">6.6. 使用SpringBootApplication 注解</a></li>
<li><a href="#_运行你的程序">6.7. 运行你的程序</a>
<ul class="sectlevel3">
<li><a href="#_从ide中运行">6.7.1. 从IDE中运行</a></li>
<li><a href="#_运行打包后的应用程序">6.7.2. 运行打包后的应用程序</a></li>
<li><a href="#_使用maven插件运行">6.7.3. 使用maven插件运行</a></li>
<li><a href="#_使用gradle插件运行">6.7.4. 使用Gradle插件运行</a></li>
<li><a href="#_热交换">6.7.5. 热交换</a></li>
</ul>
</li>
<li><a href="#_开发者工具">6.8. 开发者工具</a>
<ul class="sectlevel3">
<li><a href="#_诊断类加载问题">6.8.1. 诊断类加载问题</a></li>
<li><a href="#_默认属性">6.8.2. 默认属性</a></li>
<li><a href="#_自动重新启动">6.8.3. 自动重新启动</a></li>
<li><a href="#_灵活加载">6.8.4. 灵活加载</a></li>
<li><a href="#_全局设置">6.8.5. 全局设置</a></li>
<li><a href="#_远程应用程序">6.8.6. 远程应用程序</a></li>
</ul>
</li>
<li><a href="#_为生产环境打包应用">6.9. 为生产环境打包应用</a></li>
</ul>
</li>
<li><a href="#_核心功能">7. 核心功能</a>
<ul class="sectlevel2">
<li><a href="#_spring_application">7.1. spring application</a>
<ul class="sectlevel3">
<li><a href="#_启动失败">7.1.1. 启动失败</a></li>
<li><a href="#_懒加载">7.1.2. 懒加载</a></li>
<li><a href="#_定制banner">7.1.3. 定制Banner</a></li>
<li><a href="#_定制spirngbottapplication">7.1.4. 定制SpirngBottApplication</a></li>
<li><a href="#_流式构造api">7.1.5. 流式构造API</a></li>
<li><a href="#_应用可用性">7.1.6. 应用可用性</a></li>
<li><a href="#_应用程序事件和监听器">7.1.7. 应用程序事件和监听器</a></li>
<li><a href="#_web环境">7.1.8. web环境</a></li>
<li><a href="#_访问应用程序的参数">7.1.9. 访问应用程序的参数</a></li>
<li><a href="#_使用_applicationrunner_或_commandlinerunner">7.1.10. 使用 ApplicationRunner 或 CommandLineRunner</a></li>
<li><a href="#_应用程序退出">7.1.11. 应用程序退出</a></li>
<li><a href="#_管理特性">7.1.12. 管理特性</a></li>
<li><a href="#_应用程序启动跟踪">7.1.13. 应用程序启动跟踪</a></li>
</ul>
</li>
<li><a href="#_外部化配置">7.2. 外部化配置</a>
<ul class="sectlevel3">
<li><a href="#_命令行属性">7.2.1. 命令行属性</a></li>
<li><a href="#_json属性">7.2.2. JSON属性</a></li>
<li><a href="#_外部applicationpreperties">7.2.3. 外部ApplicationPreperties</a></li>
<li><a href="#_加密属性">7.2.4. 加密属性</a></li>
<li><a href="#_使用yaml工作">7.2.5. 使用YAML工作</a></li>
<li><a href="#_配置随机值">7.2.6. 配置随机值</a></li>
<li><a href="#_配置系统环境属性">7.2.7. 配置系统环境属性</a></li>
<li><a href="#类型安全的配置属性">7.2.8. 类型安全的配置属性</a>
<ul class="sectlevel4">
<li><a href="#JavaBean属性绑定">7.2.8.1. JavaBean属性绑定</a></li>
<li><a href="#构造函数绑定">7.2.8.2. 构造函数绑定</a></li>
<li><a href="#启用ConfigurationProperties-annotated注解">7.2.8.3. 启用@ConfigurationProperties注解</a></li>
<li><a href="#使用ConfigurationProperties-annotated注解">7.2.8.4. 使用@ConfigurationProperties注解</a></li>
<li><a href="#第三方配置">7.2.8.5. 第三方配置</a></li>
<li><a href="#RelaxedBinding">7.2.8.6. Relaxed Binding</a></li>
<li><a href="#_合并复杂类型">7.2.8.7. 合并复杂类型</a></li>
<li><a href="#_属性转换">7.2.8.8. 属性转换</a></li>
<li><a href="#_configurationproperties_验证">7.2.8.9. @ConfigurationProperties 验证</a></li>
<li><a href="#_value和类型安全配置属性之间的区别">7.2.8.10. @Value和类型安全配置属性之间的区别</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_profiles">7.3. Profiles</a>
<ul class="sectlevel3">
<li><a href="#_adding_active_profile">7.3.1. Adding Active Profile</a></li>
<li><a href="#_profile_groups">7.3.2. Profile Groups</a></li>
<li><a href="#_程序化设置profile">7.3.3. 程序化设置Profile</a></li>
<li><a href="#_特定的配置文件">7.3.4. 特定的配置文件</a></li>
</ul>
</li>
<li><a href="#_日志">7.4. 日志</a>
<ul class="sectlevel3">
<li><a href="#_日志格式">7.4.1. 日志格式</a></li>
<li><a href="#_控制台输出">7.4.2. 控制台输出</a></li>
<li><a href="#_文件输出">7.4.3. 文件输出</a></li>
<li><a href="#_文件轮换">7.4.4. 文件轮换</a></li>
<li><a href="#_日志等级">7.4.5. 日志等级</a></li>
<li><a href="#_日志组">7.4.6. 日志组</a></li>
<li><a href="#_使用日志关闭回调">7.4.7. 使用日志关闭回调</a></li>
<li><a href="#_自定义日志配置">7.4.8. 自定义日志配置</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_声明"><a class="link" href="#_声明">1. 声明</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_获取帮助"><a class="link" href="#_获取帮助">2. 获取帮助</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_文档概述"><a class="link" href="#_文档概述">3. 文档概述</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_开始"><a class="link" href="#_开始">4. 开始</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>如果你正在开始使用Spring Boot，或一般的 "Spring"，请从阅读本节开始。它回答了 "什么？"、"如何？"和 "为什么？"等基本问题。它包括对Spring Boot的介绍，以及安装说明。然后，我们将引导您构建您的第一个Spring Boot应用程序，在此过程中，我们将讨论一些核心原则。</p>
</div>
<div class="sect2">
<h3 id="_简单介绍"><a class="link" href="#_简单介绍">4.1. 简单介绍</a></h3>
<div class="paragraph">
<p>Spring Boot帮助你创建可以运行的独立的、基于Spring的生产级应用程序。我们对Spring平台和第三方库采取了有主见的观点，这样你就能以最少的麻烦开始工作。大多数Spring Boot应用程序只需要很少的Spring配置</p>
</div>
<div class="paragraph">
<p>你可以使用Spring Boot来创建Java应用程序，可以通过使用java -jar或更传统的war部署来启动。我们还提供了一个运行 "spring scripts "的命令行工具。</p>
</div>
<div class="paragraph">
<p>我们的主要目标是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>为所有的Spring开发提供更快、更广泛的入门体验</p>
</li>
<li>
<p>要有主见，但当需求开始偏离默认值时，要迅速退出。</p>
</li>
<li>
<p>提供一系列大类项目常见的非功能特性（如嵌入式服务器、安全、度量、健康检查和外部化配置）。</p>
</li>
<li>
<p>绝对没有代码生成，也不需要XML配置。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_系统要求"><a class="link" href="#_系统要求">4.2. 系统要求</a></h3>
<div class="paragraph">
<p>Spring Boot 2.7.0需要Java 8，并兼容到Java 18，包括Java 18。还需要Spring Framework 5.3.20或以上版本。</p>
</div>
<div class="paragraph">
<p>为以下构建工具提供了明确的构建支持</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Build Tool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maven</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.5+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grandle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.8.x,6.9.x,7.x</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_包含的servlet容器"><a class="link" href="#_包含的servlet容器">4.2.1. 包含的servlet容器</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ServletVersion</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat9.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jetty9.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jetty10.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">undertow2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>你也可以将Spring Boot应用部署到任何兼容servlet 3.1+的容器中。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_安装springboot"><a class="link" href="#_安装springboot">4.3. 安装SpringBoot</a></h3>
<div class="paragraph">
<p>Spring Boot可以与 "经典 "Java开发工具一起使用，也可以作为命令行工具安装。 无论哪种方式，你都需要Java SDK v1.8或更高版本。在你开始之前，你应该使用以下命令检查你当前的Java安装。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"> java -version</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你是Java开发的新手，或者你想尝试使用Spring Boot，你可能想先试试Spring Boot CLI（命令行界面）。否则，请继续阅读 "经典 "安装说明</p>
</div>
<div class="sect3">
<h4 id="_java开发工具的安装说明"><a class="link" href="#_java开发工具的安装说明">4.3.1. Java开发工具的安装说明</a></h4>
<div class="paragraph">
<p>你可以以与任何标准Java库相同的方式使用Spring Boot。要做到这一点，在你的classpath上包括适当的spring-boot-*.jar文件。Spring Boot不需要任何特殊的工具集成，所以你可以使用任何IDE或文本编辑器。另外，Spring Boot应用程序没有任何特殊之处，所以你可以像运行其他Java程序一样运行和调试Spring Boot应用程序。</p>
</div>
<div class="paragraph">
<p>虽然你可以复制Spring Boot的jar包，但我们一般建议你使用支持依赖性管理的构建工具（如Maven或Gradle）。</p>
</div>
<div class="paragraph">
<p><strong>Maven</strong></p>
</div>
<div class="paragraph">
<p>Spring Boot与Apache Maven 3.3或以上版本兼容。如果你还没有安装Maven，可以按照maven.apache.org上的说明进行。</p>
</div>
<div class="paragraph">
<p>ps:在许多操作系统上，Maven可以用软件包管理器安装。如果你使用OSX的Homebrew，可以试试brew install maven。Ubuntu用户可以运行sudo apt-get install maven。使用Chocolatey的Windows用户可以在高位（管理员）提示下运行choco install maven</p>
</div>
<div class="paragraph">
<p>Spring Boot的依赖项使用org.springframework.boot groupId。通常，你的Maven POM文件继承自spring-boot-starter-parent项目，并声明与一个或多个 "Starter "的依赖关系。Spring Boot还提供了一个可选的Maven插件，用于创建可执行jar包</p>
</div>
<div class="paragraph">
<p>关于开始使用Spring Boot和Maven的更多细节，可以在Maven插件参考指南的入门部分找到。</p>
</div>
<div class="paragraph">
<p><strong>Gradle</strong></p>
</div>
<div class="paragraph">
<p>Spring Boot与Gradle 6.8、6.9和7.x兼容。如果你还没有安装Gradle，你可以按照gradle.org的说明来做。</p>
</div>
<div class="paragraph">
<p>Spring Boot的依赖关系可以通过使用org.springframework.boot组来声明。通常情况下，你的项目会声明对一个或多个 "启动器 "的依赖关系。Spring Boot提供了一个有用的Gradle插件，可以用来简化依赖性声明和创建可执行的jar。</p>
</div>
<div class="paragraph">
<p>关于开始使用Spring Boot和Gradle的更多细节，可以在Gradle插件参考指南的入门部分找到。</p>
</div>
</div>
<div class="sect3">
<h4 id="_安装spring_boot_cli_command_line_interface"><a class="link" href="#_安装spring_boot_cli_command_line_interface">4.3.2. 安装Spring Boot CLI  (Command Line Interface)</a></h4>
<div class="paragraph">
<p>Spring Boot CLI（命令行界面）是一个命令行工具，你可以用它来快速建立Spring的原型。它允许你运行Groovy脚本，这意味着你有一个熟悉的Javalike语法，而没有那么多的模板代码。</p>
</div>
<div class="paragraph">
<p>你不需要使用CLI来使用Spring Boot，但它是一种快速的方法，可以在没有IDE的情况下让Spring应用落地。</p>
</div>
<div class="paragraph">
<p><strong>安装手册</strong></p>
</div>
<div class="paragraph">
<p>你可以从Spring软件仓库下载Spring CLI发行版。
下载后，按照解压后的档案中的INSTALL.txt说明操作。总之，在.zip文件的bin/目录下有一个spring脚本（Windows的spring.bat）。或者，你可以使用java -jar与.jar文件（该脚本帮助你确定classpath设置正确）</p>
</div>
<div class="paragraph">
<p>ps:其他的就不翻了。。。没啥意义</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_开发你的第一个spring_boot应用程序"><a class="link" href="#_开发你的第一个spring_boot应用程序">4.4. 开发你的第一个Spring Boot应用程序</a></h3>
<div class="paragraph">
<p>在此之前，要先确认java和maven符合版本要求</p>
</div>
<div class="sect3">
<h4 id="_创建pom"><a class="link" href="#_创建pom">4.4.1. 创建pom</a></h4>
<div class="paragraph">
<p>我们需要先创建一个Maven pom.xml文件。pom.xml是用于构建项目的配方。打开你喜欢的文本编辑器，添加以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#579">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span style="color:#070;font-weight:bold">&lt;project</span> <span style="color:#b48">xmlns</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://maven.apache.org/POM/4.0.0</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">xmlns:xsi</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.w3.org/2001/XMLSchema-instance</span><span style="color:#710">&quot;</span></span>    <span style="color:#b48">xsi:schemaLocation</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>    <span style="color:#070;font-weight:bold">&lt;modelVersion&gt;</span>4.0.0<span style="color:#070;font-weight:bold">&lt;/modelVersion&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>com.example<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>myproject<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;version&gt;</span>0.0.1-SNAPSHOT<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;parent&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-parent<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;version&gt;</span>2.7.0<span style="color:#070;font-weight:bold">&lt;/version&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/parent&gt;</span>
    <span style="color:#777">&lt;!-- Additional lines to be added here... --&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>前面的列表应该给你一个工作的构建。你可以通过运行mvn package来测试它（现在，你可以忽略 "jar将是空的 - 没有内容被标记为包含！"的警告）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_添加classpath依赖项"><a class="link" href="#_添加classpath依赖项">4.4.2. 添加classpath依赖项</a></h4>
<div class="paragraph">
<p>spring boot提供了一些启动器，可以把jar包添加到class path中。</p>
</div>
<div class="paragraph">
<p>其他 "启动器 "提供了开发特定类型的应用程序时可能需要的依赖项。由于我们正在开发一个Web应用程序，我们添加一个spring-boot-starter-web依赖项。在此之前，我们可以通过运行下面的命令来看看我们目前拥有什么。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ mvn dependency:tree
[INFO] com.example:myproject:jar:0.0.1-SNAPSHOT</code></pre>
</div>
</div>
<div class="paragraph">
<p>mvn dependency:tree命令打印出项目依赖关系的树状图。你可以看到spring-boot-starter-parent本身没有提供任何依赖关系。要添加必要的依赖，请编辑你的pom.xml，并在父部分下面添加spring-boot-starter-web依赖。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-web<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你再次运行mvn dependency:tree，你会看到现在有一些额外的依赖，包括Tomcat网络服务器和Spring Boot本身。</p>
</div>
</div>
<div class="sect3">
<h4 id="_写代码"><a class="link" href="#_写代码">4.4.3. 写代码</a></h4>
<div class="paragraph">
<p>为了完成我们的应用，我们需要创建一个单独的Java文件。默认情况下，Maven从src/main/java编译源代码，所以你需要创建该目录结构，然后添加一个名为src/main/java/MyApplication.java的文件，包含以下代码。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.web.bind.annotation.RequestMapping</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.web.bind.annotation.RestController</span>;

<span style="color:#007">@RestController</span>
<span style="color:#007">@EnableAutoConfiguration</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#007">@RequestMapping</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#0a8;font-weight:bold">String</span> home() {
        <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Hello World!</span><span style="color:#710">&quot;</span></span>;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>虽然这里的代码不多，但有相当多的事情要做。我们在接下来的几节中逐步介绍重要的部分。</p>
</div>
<div class="paragraph">
<p><strong>@RestController和@RequestingMapping注解</strong></p>
</div>
<div class="paragraph">
<p>我们的MyApplication类的第一个注解是@RestController。这被称为定型注解。它为阅读代码的人和Spring提供了提示，说明这个类扮演了一个特殊的角色。在本例中，我们的类是一个Web @Controller，所以Spring在处理传入的Web请求时考虑它。</p>
</div>
<div class="paragraph">
<p>@RequestMapping注解提供了 "路由 "信息。它告诉Spring，任何带有/路径的HTTP请求都应该被映射到主页方法。@RestController注解告诉Spring将结果字符串直接渲染给调用者。</p>
</div>
<div class="paragraph">
<p><strong>@EnableAutoConfiguration 注解</strong></p>
</div>
<div class="paragraph">
<p>第二个类级注解是@EnableAutoConfiguration。这个注解告诉Spring Boot根据你添加的jar依赖项 "猜测 "你想如何配置Spring。由于spring-boot-starter-web添加了Tomcat和Spring MVC，自动配置会假定你正在开发一个Web应用，并相应地设置Spring。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>自动配置的设计是为了与 "启动器 "很好地合作，但这两个概念并不直接挂钩。你可以在 "启动器 "之外自由挑选jar依赖项。Spring Boot仍然会尽力自动配置你的应用程序。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>The "main" Method</strong></p>
</div>
<div class="paragraph">
<p>我们应用程序的最后部分是main方法。这是一个标准的方法，遵循应用程序入口点的Java惯例。我们的main方法通过调用run委托给Spring Boot的SpringApplication类。SpringApplication引导我们的应用程序，启动Spring，而Spring又会启动自动配置的Tomcat网络服务器。我们需要将MyApplication.class作为参数传给run方法，以告诉SpringApplication哪个是主要的Spring组件。args数组也被传入，以显示任何命令行参数。</p>
</div>
</div>
<div class="sect3">
<h4 id="_运行案例"><a class="link" href="#_运行案例">4.4.4. 运行案例</a></h4>
<div class="paragraph">
<p>在这一点上，你的应用程序应该工作了。由于你使用了spring-boot-starter-parent POM，你有一个有用的运行目标，你可以用它来启动应用程序。在项目根目录下输入mvn spring-boot:run来启动应用程序。你应该看到类似以下的输出。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mvn spring-boot:run

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::  (v2.7.0)
....... . . .
....... . . . (log output here)
....... . . .
........ Started MyApplication in 2.222 seconds (JVM running for 6.514)</pre>
</div>
</div>
<div class="paragraph">
<p>打开浏览器访问 "localhost:8080"   看到 hello world输出</p>
</div>
</div>
<div class="sect3">
<h4 id="_创建可执行jar包"><a class="link" href="#_创建可执行jar包">4.4.5. 创建可执行jar包</a></h4>
<div class="paragraph">
<p>我们通过创建一个完全独立的可执行jar文件来完成我们的例子，我们可以在生产中运行。可执行的jar文件（有时称为 "fat jar"）是包含你的编译类以及你的代码运行所需的所有jar依赖项的档案。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Java没有提供一个标准的方法来加载嵌套的jar文件（jar文件本身包含在jar中）。如果你想发布一个独立的应用程序，这可能是个问题。</p>
</div>
<div class="paragraph">
<p>为了解决这个问题，许多开发者使用 "uber "jar。uber jar将所有应用程序依赖的所有类打包成一个单一的存档。这种方法的问题是，很难看到哪些库在你的应用程序中。如果在多个jar中使用相同的文件名（但内容不同），也会产生问题。</p>
</div>
<div class="paragraph">
<p>Spring Boot采取了一种不同的方法，让你直接嵌套jars。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>为了创建一个可执行的jar，我们需要在pom.xml中添加spring-boot-maven-plugin。要做到这一点，请在依赖关系部分下面插入以下几行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;build&gt;
    &lt;plugins&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_下一步干啥"><a class="link" href="#_下一步干啥">4.5. 下一步干啥</a></h3>
<div class="paragraph">
<p>希望本节提供了一些Spring Boot的基础知识，让你开始编写自己的应用程序。如果你是一个以任务为导向的开发者，你可能想跳到spring.io，跟随一些入门指南，解决 "我如何用Spring做这个？"的具体问题。我们也有针对Spring Boot的 "如何操作 "参考文档。</p>
</div>
<div class="paragraph">
<p>否则，下一个合乎逻辑的步骤是阅读6.使用Spring Boot开发。如果你真的没有耐心，你也可以跳到前面去读Spring Boot的功能。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_升级springboot"><a class="link" href="#_升级springboot">5. 升级SpringBoot</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>关于如何从Spring Boot的早期版本升级的说明，在项目的wiki上提供。按照发行说明部分的链接，找到你要升级的版本。</p>
</div>
<div class="paragraph">
<p>升级说明总是在发行说明中的第一项。如果你落后一个以上的版本，请确保你也查看你跳过的版本的发布说明。</p>
</div>
<div class="sect2">
<h3 id="_从1_x升级"><a class="link" href="#_从1_x升级">5.1. 从1.x升级</a></h3>
<div class="paragraph">
<p>如果你要从Spring Boot的1.x版本升级，请查看项目wiki上的 "迁移指南"，其中提供了详细的升级说明。还可以查看 "发布说明"，了解每个版本的 "新的和值得注意的 "功能列表。</p>
</div>
</div>
<div class="sect2">
<h3 id="_升级到新功能版本"><a class="link" href="#_升级到新功能版本">5.2. 升级到新功能版本</a></h3>
<div class="paragraph">
<p>在升级到新的功能版本时，一些属性可能已经被重新命名或删除。Spring Boot提供了一种方法，可以在启动时分析你的应用程序的环境并打印诊断结果，但也可以在运行时为你临时迁移属性。要启用该功能，请在你的项目中添加以下依赖关系。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-properties-migrator&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在环境中添加得较晚的属性，例如使用@PropertySource时，将不会被考虑在内。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>一旦你完成了迁移，请确保从你的项目的依赖中删除这个模块。</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_使用spring_boot开发"><a class="link" href="#_使用spring_boot开发">6. 使用Spring Boot开发</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>本节更详细地介绍了你应该如何使用Spring Boot。它涵盖了诸如构建系统、自动配置、以及如何运行你的应用程序等主题。我们还介绍了一些Spring Boot的最佳实践。虽然Spring Boot没有什么特别之处（它只是另一个你可以使用的库），但有一些建议，如果遵循这些建议，可以使你的开发过程更容易一些。</p>
</div>
<div class="paragraph">
<p>如果你开始使用Spring Boot，在进入本节之前，你可能应该先阅读入门指南。</p>
</div>
<div class="sect2">
<h3 id="_依赖管理工具"><a class="link" href="#_依赖管理工具">6.1. 依赖管理工具</a></h3>
<div class="paragraph">
<p>Spring Boot的每个版本都提供了一个它所支持的依赖关系的精选列表。在实践中，你不需要在构建配置中为这些依赖提供一个版本，因为Spring Boot会为你管理这些。当你升级Spring Boot本身时，这些依赖项也会以一致的方式被升级。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>You can still specify a version and override Spring Boot’s recommendations if you need to do so.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>这份精心策划的清单包含了所有可以在Spring Boot中使用的Spring模块，以及一份精致的第三方库清单。该列表以标准材料清单（spring-boot-dependencies）的形式提供，可与Maven和Gradle一起使用。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Spring Boot的每个版本都与Spring框架的基本版本有关。我们强烈建议你不要指定其版本</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_maven"><a class="link" href="#_maven">6.1.1. Maven</a></h4>

</div>
<div class="sect3">
<h4 id="_gradle"><a class="link" href="#_gradle">6.1.2. Gradle</a></h4>

</div>
<div class="sect3">
<h4 id="_ant"><a class="link" href="#_ant">6.1.3. Ant</a></h4>

</div>
<div class="sect3">
<h4 id="_启动器"><a class="link" href="#_启动器">6.1.4. 启动器</a></h4>
<div class="paragraph">
<p>启动器是一组方便的依赖描述符，你可以在你的应用程序中包含它们。你可以获得所有你需要的Spring和相关技术的一站式服务，而不需要在样本代码中寻找和复制粘贴大量的依赖描述符。例如，如果你想开始使用Spring和JPA进行数据库访问，在你的项目中包括spring-boot-starter-data-jpa依赖项。</p>
</div>
<div class="paragraph">
<p>启动程序包含了很多你需要的依赖，以使项目快速启动和运行，并拥有一套一致的、受支持的可管理的过渡性依赖。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>名字里有什么</p>
</div>
<div class="paragraph">
<p>所有的官方启动器都遵循一个类似的命名模式；spring-boot-starter-，其中是一个特定的应用类型。这种命名结构是为了帮助你找到启动程序。许多IDE中的Maven集成让你可以按名称搜索依赖关系。例如，在安装了相应的Eclipse或Spring Tools插件后，你可以在POM编辑器中按下ctrl-space，然后输入
"spring-boot-starter"，就能得到完整的列表。
正如 "创建你自己的启动器 "一节所解释的，第三方启动器不应该以spring-boot开头，因为它是为官方Spring Boot工件保留的。相反，第三方启动器通常以项目的名称开始。例如，一个名为thirdpartyproject的第三方启动器项目通常会被命名为thirdpartyproject-spring-boot-starter。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>以下是Spring Boot在org.springframework.boot组下提供的应用程序启动器。</p>
</div>
<div class="paragraph">
<p><strong>请参考原文档</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_写代码_2"><a class="link" href="#_写代码_2">6.2. 写代码</a></h3>
<div class="paragraph">
<p>Spring Boot并不要求任何特定的代码布局来工作。但是，有一些最佳实践可以帮助。</p>
</div>
<div class="sect3">
<h4 id="_使用_default_包"><a class="link" href="#_使用_default_包">6.2.1. 使用 "default "包</a></h4>
<div class="paragraph">
<p>当一个类不包括包声明时，它被认为是在 "默认包 "中。一般来说，不鼓励使用 "默认包"，应该避免使用。对于使用@ComponentScan、@ConfigurationPropertiesScan、@EntityScan或@SpringBootApplication注解的Spring Boot应用程序来说，它可能会造成特别的问题，因为每个jar中的每个类都会被读取。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>我们建议你遵循Java推荐的包的命名惯例，并使用反转的域名（例如，com.example.project）。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_找到主应用程序类"><a class="link" href="#_找到主应用程序类">6.2.2. 找到主应用程序类</a></h4>
<div class="paragraph">
<p>我们通常建议你将你的主应用程序类放在一个根包中，高于其他类。@SpringBootApplication注解通常被放在你的主类上，它隐含地定义了某些项目的基础 "搜索包"。例如，如果你正在编写一个JPA应用程序，@SpringBootApplication注解类的包被用来搜索@Entity项目。使用一个根包也允许组件扫描只适用于你的项目。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你不想使用@SpringBootApplication，它所导入的@EnableAutoConfiguration和@ComponentScan注解定义了该行为，所以你也可以使用这些来代替。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>经典布局</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com
 +- example
     +- myapplication
         +- MyApplication.java
         |
         +- customer
         |   +- Customer.java
         |   +- CustomerController.java
         |   +- CustomerService.java
         |   +- CustomerRepository.java
         |
         +- order
             +- Order.java
             +- OrderController.java
             +- OrderService.java
             +- OrderRepository.java</pre>
</div>
</div>
<div class="paragraph">
<p>MyApplication.java文件将声明main方法，以及基本的@SpringBootApplication，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置类"><a class="link" href="#_配置类">6.3. 配置类</a></h3>
<div class="paragraph">
<p>Spring Boot更倾向于基于Java的配置。虽然可以使用SpringApplication与XML来源，但我们通常建议你的主要来源是一个单一的@Configuration类。通常，定义main方法的类是作为主要@Configuration的良好候选者。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>互联网上已经发布了许多使用XML配置的Spring配置实例。如果可能的话，建议使用基于Java的等效配置。搜索Enable*注解可以是一个很好的起点。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_导入额外的配置类"><a class="link" href="#_导入额外的配置类">6.3.1. 导入额外的配置类</a></h4>
<div class="paragraph">
<p>你不需要把所有的@Configuration放到一个单一的类中。可以使用@Import注解来导入其他配置类。另外，你可以使用@ComponentScan来自动拾取所有Spring组件，包括@Configuration类。</p>
</div>
</div>
<div class="sect3">
<h4 id="_导入xml配置"><a class="link" href="#_导入xml配置">6.3.2. 导入xml配置</a></h4>
<div class="paragraph">
<p>如果你绝对必须使用基于XML的配置，我们建议你仍然从@Configuration类开始。然后你可以使用@ImportResource 注解来加载 XML 配置文件。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自动配置"><a class="link" href="#_自动配置">6.4. 自动配置</a></h3>
<div class="paragraph">
<p>Spring Boot的自动配置试图根据你所添加的jar依赖项自动配置你的Spring应用程序。例如，如果HSQLDB在你的classpath上，而且你没有手动配置任何数据库连接bean，那么Spring Boot就会自动配置内存数据库。</p>
</div>
<div class="paragraph">
<p>你需要将@EnableAutoConfiguration或@SpringBootApplication注解添加到你的@Configuration类中，从而选择加入自动配置。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你应该只添加一个@SpringBootApplication或@EnableAutoConfiguration注释。我们通常建议你只在你的主要的@Configuration类中添加一个或另一个。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_逐步取代自动配置"><a class="link" href="#_逐步取代自动配置">6.4.1. 逐步取代自动配置</a></h4>
<div class="paragraph">
<p>自动配置是非侵入性的。在任何时候，你都可以开始定义你自己的配置来取代自动配置的特定部分。例如，如果你添加了你自己的DataSource Bean，默认的嵌入式数据库支持就会后退。</p>
</div>
<div class="paragraph">
<p>如果你需要找出当前正在应用的自动配置，以及为什么，用&#8212;&#8203;debug开关启动你的应用程序。这样做可以为选定的核心记录器启用调试日志，并将条件报告记录到控制台。</p>
</div>
</div>
<div class="sect3">
<h4 id="_禁用特定的自动配置类"><a class="link" href="#_禁用特定的自动配置类">6.4.2. 禁用特定的自动配置类</a></h4>
<div class="paragraph">
<p>如果你发现你不想要的特定自动配置类被应用，你可以使用@SpringBootApplication的排除属性来禁用它们，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration</span>;

<span style="color:#007">@SpringBootApplication</span>(exclude = { DataSourceAutoConfiguration.class })
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果该类不在classpath上，你可以使用注解的excludeName属性并指定完全合格的名称来代替。如果你喜欢使用@EnableAutoConfiguration而不是@SpringBootApplication，也可以使用exclude和excludeName。最后，你也可以通过使用spring.autoconfigure.exclude属性来控制要排除的自动配置类列表。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你可以在注释层面和使用属性来定义排除法。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>即使自动配置类是公共的，但唯一被认为是公共API的方面是类的名称，可以用于禁用自动配置。这些类的实际内容，如嵌套的配置类或Bean方法，只供内部使用，我们不建议直接使用这些内容。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_bean和依赖性注入"><a class="link" href="#_spring_bean和依赖性注入">6.5. Spring Bean和依赖性注入</a></h3>
<div class="paragraph">
<p>你可以自由地使用任何标准的Spring框架技术来定义你的Bean及其注入的依赖关系。我们通常建议使用构造函数注入来连接依赖关系，并使用@ComponentScan来查找Bean。</p>
</div>
<div class="paragraph">
<p>如果你按照上面的建议构造你的代码（将你的应用类定位在顶级包中），你可以在没有任何参数的情况下添加@ComponentScan，或者使用@SpringBootApplication注解来隐含地包含它。你所有的应用组件（@Component、@Service、@Repository、@Controller等）都会自动注册为Spring Bean。</p>
</div>
<div class="paragraph">
<p>下面的例子显示了一个@服务Bean，它使用构造函数注入来获得一个所需的RiskAssessor Bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Service</span>;

<span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyAccountService</span> <span style="color:#088;font-weight:bold">implements</span> AccountService {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> RiskAssessor riskAssessor;

    <span style="color:#088;font-weight:bold">public</span> MyAccountService(RiskAssessor riskAssessor) {
        <span style="color:#950">this</span>.riskAssessor = riskAssessor;
    }

    <span style="color:#777">// ...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果一个Bean有多个构造函数，你需要用@Autowired来标记你希望Spring使用的那个。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.io.PrintStream</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.beans.factory.annotation.Autowired</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Service</span>;

<span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyAccountService</span> <span style="color:#088;font-weight:bold">implements</span> AccountService {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> RiskAssessor riskAssessor;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">PrintStream</span> out;

    <span style="color:#007">@Autowired</span>
    <span style="color:#088;font-weight:bold">public</span> MyAccountService(RiskAssessor riskAssessor) {
        <span style="color:#950">this</span>.riskAssessor = riskAssessor;
        <span style="color:#950">this</span>.out = <span style="color:#0a8;font-weight:bold">System</span>.out;
    }

    <span style="color:#088;font-weight:bold">public</span> MyAccountService(RiskAssessor riskAssessor, <span style="color:#0a8;font-weight:bold">PrintStream</span> out) {
        <span style="color:#950">this</span>.riskAssessor = riskAssessor;
        <span style="color:#950">this</span>.out = out;
    }

    <span style="color:#777">// ...</span>

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>请注意，使用构造器注入让riskAssessor字段被标记为final，表明它随后不能被改变。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_使用springbootapplication_注解"><a class="link" href="#_使用springbootapplication_注解">6.6. 使用SpringBootApplication 注解</a></h3>
<div class="paragraph">
<p>许多Spring Boot开发者希望他们的应用程序能够使用自动配置、组件扫描，并且能够在他们的 "应用程序类 "上定义额外的配置。一个@SpringBootApplication注解就可以用来启用这三种功能，也就是说：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@EnableAutoConfiguration：启用Spring Boot的自动配置机制。</p>
</li>
<li>
<p>@ComponentScan：在应用程序所在的包上启用@Component扫描（见最佳实践）。</p>
</li>
<li>
<p>@SpringBootConfiguration：允许在上下文中注册额外的Bean或导入额外的配置类。这是Spring标准的@Configuration的替代方案，有助于在你的集成测试中检测配置。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

// Same as @SpringBootConfiguration @EnableAutoConfiguration @ComponentScan
@SpringBootApplication
public class MyApplication {

    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>@SpringBootApplication还提供了别名来定制@EnableAutoConfiguration和@ComponentScan的属性。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>这些功能都不是强制性的，你可以选择用它所启用的任何功能来代替这个单一的注释。例如，你可能不希望在你的应用程序中使用组件扫描或配置属性扫描。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringBootConfiguration</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.annotation.Import</span>;

<span style="color:#007">@SpringBootConfiguration</span>(proxyBeanMethods = <span style="color:#069">false</span>)
<span style="color:#007">@EnableAutoConfiguration</span>
<span style="color:#007">@Import</span>({ SomeConfiguration.class, AnotherConfiguration.class })
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，MyApplication和其他Spring Boot应用程序一样，只是没有自动检测到@Component-annotated类和@ConfigurationProperties-annotated类，而是明确导入了用户定义的Bean（见@Import）。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_运行你的程序"><a class="link" href="#_运行你的程序">6.7. 运行你的程序</a></h3>
<div class="paragraph">
<p>将你的应用程序打包成jar并使用嵌入式HTTP服务器的最大优势之一是，你可以像其他应用程序一样运行你的应用程序。该样本适用于调试Spring Boot应用程序。你不需要任何特殊的IDE插件或扩展。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>本节只涉及基于jar的打包。如果你选择将你的应用程序打包成war文件，请参阅你的服务器和IDE文档。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从ide中运行"><a class="link" href="#_从ide中运行">6.7.1. 从IDE中运行</a></h4>
<div class="paragraph">
<p>你可以从你的IDE中把Spring Boot应用程序作为一个Java应用程序运行。不过，你首先需要导入你的项目。导入步骤因你的IDE和构建系统而异。大多数IDE可以直接导入Maven项目。例如，Eclipse用户可以从文件菜单中选择导入&#8230;&#8203;→现有Maven项目。</p>
</div>
<div class="paragraph">
<p>如果你不能直接将项目导入IDE，你可以通过使用构建插件来生成IDE元数据。Maven包括Eclipse和IDEA的插件。Gradle为各种IDE提供插件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_运行打包后的应用程序"><a class="link" href="#_运行打包后的应用程序">6.7.2. 运行打包后的应用程序</a></h4>

</div>
<div class="sect3">
<h4 id="_使用maven插件运行"><a class="link" href="#_使用maven插件运行">6.7.3. 使用maven插件运行</a></h4>

</div>
<div class="sect3">
<h4 id="_使用gradle插件运行"><a class="link" href="#_使用gradle插件运行">6.7.4. 使用Gradle插件运行</a></h4>

</div>
<div class="sect3">
<h4 id="_热交换"><a class="link" href="#_热交换">6.7.5. 热交换</a></h4>
<div class="paragraph">
<p>由于Spring Boot应用程序是普通的Java应用程序，JVM热交换应该可以开箱即用。JVM热交换所能替换的字节码有一定的限制。要想获得更完整的解决方案，可以使用JRebel。</p>
</div>
<div class="paragraph">
<p>spring-boot-devtools模块也包括对快速重启应用程序的支持。详情请见17.14热插拔 "How-to"。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_开发者工具"><a class="link" href="#_开发者工具">6.8. 开发者工具</a></h3>
<div class="paragraph">
<p>Spring Boot包括一套额外的工具，可以使应用程序开发的体验更加愉快。Spring-boot-devtools模块可以包含在任何项目中，提供额外的开发时间功能。要包含devtools支持，请将模块依赖性添加到构建中，如以下Maven和Gradle的列表所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;dependencies&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;dependency&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-devtools<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;optional&gt;</span>true<span style="color:#070;font-weight:bold">&lt;/optional&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/dependency&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="gradle">dependencies {
    developmentOnly(&quot;org.springframework.boot:spring-boot-devtools&quot;)
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Devtools可能会导致classloading问题，特别是在多模块项目中。诊断6.8.1类加载问题》解释了如何诊断和解决这些问题</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>当运行一个完全打包的应用程序时，开发者工具会被自动禁用。如果你的应用程序是从java -jar启动的，或者是从一个特殊的classloader启动的，那么它就被认为是一个 "生产应用程序"。你可以通过使用spring.devtools.restart.enabled系统属性来控制这种行为。要启用devtools，无论用于启动你的应用程序的类加载器是什么，设置-Dspring.devtools.restart.enabled=true系统属性。在生产环境中不能这样做，因为运行devtools会有安全风险。要禁用devtools，请排除该依赖关系或设置-Dspring.devtools.restart.enabled=false系统属性。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在Maven中把该依赖标记为可选，或在Gradle中使用developmentOnly配置（如上图所示），可以防止devtools被过渡应用到使用你的项目的其他模块。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>重新打包的归档文件默认不包含devtools。如果你想使用某个远程devtools功能，你需要包含它。使用Maven插件时，将excludeDevtools属性设为false。使用Gradle插件时，配置任务的classpath，使其包含developmentOnly配置。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_诊断类加载问题"><a class="link" href="#_诊断类加载问题">6.8.1. 诊断类加载问题</a></h4>
<div class="paragraph">
<p>正如在重启与重载部分所描述的，重启功能是通过使用两个类加载器来实现的。对于大多数应用程序来说，这种方法运行良好。然而，它有时会引起类加载问题，特别是在多模块项目中。</p>
</div>
<div class="paragraph">
<p>为了诊断是否真的是devtools和它的两个类加载器造成的类加载问题，可以尝试禁用重启。如果这能解决你的问题，请定制重启类加载器以包括你的整个项目。</p>
</div>
</div>
<div class="sect3">
<h4 id="_默认属性"><a class="link" href="#_默认属性">6.8.2. 默认属性</a></h4>
<div class="paragraph">
<p>Spring Boot支持的几个库使用缓存来提高性能。例如，模板引擎会缓存已编译的模板，以避免重复解析模板文件。另外，Spring MVC在提供静态资源时可以在响应中添加HTTP缓存头。</p>
</div>
<div class="paragraph">
<p>虽然缓存在生产中非常有利，但在开发过程中可能会产生反作用，使你无法看到你刚刚在应用中的变化。由于这个原因，spring-boot-devtools默认禁用了缓存选项。</p>
</div>
<div class="paragraph">
<p>缓存选项通常是通过application.properties文件中的设置来配置的。例如，Thymeleaf提供了spring.thymeleaf.cache属性。与其需要手动设置这些属性，spring-boot-devtools模块自动应用合理的开发时配置。</p>
</div>
<div class="paragraph">
<p>下表列出了所有被应用的属性。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>见原文档相应位置</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你不希望应用属性默认值，你可以在application.properties中把spring.devtools.add-perties设置为false。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>因为在开发Spring MVC和Spring WebFlux应用程序时，你需要更多关于Web请求的信息，开发者工具建议你为Web日志组启用DEBUG日志。这将给你提供关于传入请求的信息，哪个处理程序正在处理它，响应结果，以及其他细节。如果你希望记录所有的请求细节（包括潜在的敏感信息），你可以打开spring.mvc.log-request-details 或 spring.codec.log-request-details 配置属性。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自动重新启动"><a class="link" href="#_自动重新启动">6.8.3. 自动重新启动</a></h4>
<div class="paragraph">
<p>使用spring-boot-devtools的应用程序会在classpath上的文件发生变化时自动重启。当在IDE中工作时，这可能是一个有用的功能，因为它为代码变化提供了一个非常快速的反馈回路。默认情况下，classpath上任何指向目录的条目都会被监测到变化。注意，某些资源，如静态资产和视图模板，不需要重新启动应用程序。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>触发重启</strong></p>
</div>
<div class="paragraph">
<p>由于DevTools监控classpath资源，触发重启的唯一方法是更新classpath。无论你使用的是IDE还是构建插件，修改的文件都必须被重新编译以触发重启。导致更新classpath的方式取决于你所使用的工具。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在Eclipse中，保存一个修改过的文件会导致classpath被更新并触发重启。</p>
</li>
<li>
<p>在IntelliJ IDEA中，构建项目（Build → Build Project）也有同样的效果。</p>
</li>
<li>
<p>如果使用构建插件，运行Maven的mvn compile或Gradle的gradle build将触发重启。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你使用Maven或Gradle的构建插件重启，你必须将分叉设置为启用。如果你禁用分叉，devtools使用的隔离应用程序类加载器将不会被创建，重启将无法正常运行。</p>
</div>
<div class="paragraph">
<p>If you are restarting with Maven or Gradle using the build plugin you must leave the 
forking set to enabled. If you disable forking, the isolated application classloader used by devtools will not be created and restarts will not operate properly.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>自动重启在与LiveReload一起使用时效果非常好。详见LiveReload部分。如果你使用JRebel，自动重启将被禁用，以支持动态类重载。其他devtools功能（如LiveReload和属性覆盖）仍然可以使用。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>DevTools依靠应用程序上下文的关闭钩子来在重启期间关闭它。如果你禁用了关闭钩子（SpringApplication.setRegisterShutdownHook(false)），它就不能正确工作。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>DevTools需要定制ApplicationContext所使用的ResourceLoader。如果你的应用程序已经提供了一个，那么它将被包裹起来。不支持直接覆盖 ApplicationContext 上的 getResource 方法。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在使用AspectJ weaving时自动重启无法使用</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>重启与重载</strong></p>
</div>
<div class="paragraph">
<p>Spring Boot提供的重启技术通过使用两个类加载器来工作。不变的类（例如，来自第三方jars的类）被加载到基础类加载器。你正在开发的类被加载到重启类加载器中。当应用程序被重新启动时，重启类加载器被丢弃，并被创建一个新的。这种方法意味着应用程序的重启通常比 "冷启动 "快得多，因为基础类加载器已经可用并被填充。</p>
</div>
<div class="paragraph">
<p>如果你发现重启对你的应用程序来说不够快，或者你遇到了类加载问题，你可以考虑重载技术，如ZeroTurnaround的JRebel。这些技术的工作原理是在类被加载时对其进行重写，使其更容易被重载。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>记录条件评估的变化</strong></p>
</div>
<div class="paragraph">
<p>默认情况下，每次你的应用程序重新启动时，都会记录一份显示条件评估delta的报告。该报告显示了你的应用程序的自动配置的变化，因为你做了一些改变，如添加或删除豆子和设置配置属性。</p>
</div>
<div class="paragraph">
<p>要禁用报告的记录，请设置以下属性。</p>
</div>
<div class="paragraph">
<p><code>
springdevtoolsrestartlog-condition-evaluation-delta=false
</code></p>
</div>
<div class="paragraph">
<p><strong>排除资源</strong></p>
</div>
<div class="paragraph">
<p>某些资源在被改变时不一定需要触发重启。例如，Thymeleaf模板可以就地编辑。默认情况下，改变/META-INF/maven、/META-INF/resources、/resources、/static、/public或/templates中的资源不会触发重启，但会触发实时重载。如果你想自定义这些排除项，你可以使用spring.devtools.restart.exclude属性。例如，要只排除/static和/public，你可以设置以下属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.devtools.restart.exclude=static/** ,public/**</pre>
</div>
</div>
<div class="paragraph">
<p>如果你想保留这些默认值并添加额外的排除项，请使用spring.devtools.restart.extra-exclude属性代替。</p>
</div>
<div class="paragraph">
<p><strong>监视其他路径</strong></p>
</div>
<div class="paragraph">
<p>当你对不在classpath上的文件进行修改时，你可能希望你的应用程序被重新启动或重新加载。</p>
</div>
<div class="paragraph">
<p>为此，使用 spring.devtools.restart.extra-paths 属性来配置观察变化的额外路径。你可以使用前面描述的 spring.devtools.restart.exclude 属性来控制附加路径下的变化是否会触发完全重启或实时重载。</p>
</div>
<div class="paragraph">
<p><strong>禁用重新启动</strong></p>
</div>
<div class="paragraph">
<p>如果你不想使用重启功能，你可以使用spring.devtools.restart.enabled属性来禁用它。在大多数情况下，你可以在你的application.properties中设置这个属性（这样做仍然会初始化重启类加载器，但它不会观察文件变化）。</p>
</div>
<div class="paragraph">
<p>如果你需要完全禁用重启支持（例如，因为它不能与特定的库一起工作），你需要在调用SpringApplication.run(&#8230;&#8203;)之前将spring.devtools.restart.enabled系统属性设置为false，如以下例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#0a8;font-weight:bold">System</span>.setProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">spring.devtools.restart.enabled</span><span style="color:#710">&quot;</span></span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">false</span><span style="color:#710">&quot;</span></span>);
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>使用触发器文件</strong></p>
</div>
<div class="paragraph">
<p>如果你使用一个持续编译修改过的文件的IDE工作，你可能更喜欢只在特定时间触发重启。要做到这一点，你可以使用一个 "触发文件"，这是一个特殊的文件，当你想实际触发重启检查时，必须对它进行修改。</p>
</div>
<div class="paragraph">
<p>对文件的任何更新都会触发检查，但只有在Devtools检测到它有事情要做时才会实际重新启动。</p>
</div>
<div class="paragraph">
<p>要使用触发器文件，将spring.devtools.restart.trigger-file属性设置为触发器文件的名称（不包括任何路径）。触发器文件必须出现在你的classpath上的某个地方。</p>
</div>
<div class="paragraph">
<p>例如，如果你有一个结构如下的项目。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>src
+- main
   +- resources
      +- .reloadtrigger</pre>
</div>
</div>
<div class="paragraph">
<p>那么你的触发器文件属性将是:</p>
</div>
<div class="paragraph">
<p><code>
spring.devtools.restart.trigger-file=.reloadtrigger
</code></p>
</div>
<div class="paragraph">
<p>现在只有当 src/main/resources/.reloadtrigger 被更新时才会重新启动。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你可能想把spring.devtools.restart.trigger-file设置为全局设置，这样你的所有项目都会以同样的方式行事。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>有些IDE有一些功能，使你不需要手动更新你的触发器文件。Eclipse的Spring工具和IntelliJ IDEA（终极版）都有这种支持。对于Spring Tools，你可以使用控制台视图中的 "reload "按钮（只要你的触发器文件被命名为.reloadtrigger）。对于IntelliJ IDEA，你可以按照其文档中的说明进行操作。</p>
</div>
<div class="paragraph">
<p><strong>定制重启类加载器</strong></p>
</div>
<div class="paragraph">
<p>正如前面在重启与重载部分所描述的，重启功能是通过使用两个类加载器实现的。如果这导致了问题，你可能需要自定义哪个类加载器会加载什么。</p>
</div>
<div class="paragraph">
<p>默认情况下，你的IDE中任何打开的项目都是用 "重启 "类加载器加载的，而任何普通的.jar文件都是用 "基础 "类加载器加载的。如果你使用mvn spring-boot:run或gradle bootRun也是如此：包含@SpringBootApplication的项目用 "restart "类加载器加载，其他的都用 "base "类加载器。</p>
</div>
<div class="paragraph">
<p>你可以通过创建META-INF/spring-devtools.properties文件，指示Spring Boot用不同的类加载器加载你的项目的部分内容。spring-devtools.properties文件可以包含以restart.exclude和restart.include为前缀的属性。include元素是应该被拉到 "restart "类加载器中的项目，exclude元素是应该被推到 "base "类加载器中的项目。该属性的值是一个应用于classpath的regex模式，如以下例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>restart.exclude.companycommonlibs=/mycorp-common-[\\w\\d-\\.]+\\.jar
restart.include.projectcommon=/mycorp-myproj-[\\w\\d-\\.]+\\.jar</pre>
</div>
</div>
<div class="paragraph">
<p>所有的属性键必须是唯一的。只要一个属性以restart.include.或restart.exclude.开头，它就被认为是。</p>
</div>
<div class="paragraph">
<p>所有来自classpath的META-INF/spring-devtools.properties都被加载。你可以在你的项目中打包文件，或者在项目所消耗的库中打包文件。</p>
</div>
<div class="paragraph">
<p><strong>已知的限制</strong></p>
</div>
<div class="paragraph">
<p>重启功能对于通过使用标准ObjectInputStream进行反序列化的对象来说效果并不好。如果你需要反序列化数据，你可能需要使用Spring的ConfigurableObjectInputStream与Thread.currentThread().getContextClassLoader()相结合。</p>
</div>
<div class="paragraph">
<p>不幸的是，一些第三方库在反序列化时没有考虑上下文类加载器。如果你发现这样的问题，你需要向原作者请求修复。</p>
</div>
</div>
<div class="sect3">
<h4 id="_灵活加载"><a class="link" href="#_灵活加载">6.8.4. 灵活加载</a></h4>
<div class="paragraph">
<p>spring-boot-devtools模块包括一个内嵌的LiveReload服务器，可以用来在资源发生变化时触发浏览器刷新。LiveReload浏览器扩展可以从livereload.com免费获得，用于Chrome、Firefox和Safari。</p>
</div>
<div class="paragraph">
<p>如果你不想在你的应用程序运行时启动LiveReload服务器，你可以将spring.devtools.livereload.enabled属性设置为假。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你一次只能运行一个LiveReload服务器。在启动你的应用程序之前，确保没有其他LiveReload服务器正在运行。如果你从你的IDE启动多个应用程序，只有第一个有LiveReload支持。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>文件变化时触发LiveReload，必须启用自动重启。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_全局设置"><a class="link" href="#_全局设置">6.8.5. 全局设置</a></h4>
<div class="paragraph">
<p>你可以通过在$HOME/.config/spring-boot目录下添加以下任何文件来配置全局devtools设置。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>spring-boot-devtoold.properties</code></p>
</li>
<li>
<p><code>spring-boot-devtools.yaml</code></p>
</li>
<li>
<p><code>spring-boot-devtools.yml</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>添加到这些文件的任何属性都适用于你机器上所有使用devtools的Spring Boot应用程序。例如，要将重启配置为总是使用触发器文件，你可以在spring-boot-devtools文件中添加以下属性。</p>
</div>
<div class="paragraph">
<p><code>
spring.devtools.restart.trigger-file=.reloadtrigger
</code></p>
</div>
<div class="paragraph">
<p>默认情况下，$HOME是用户的主目录。要自定义这个位置，请设置SPRING_DEVTOOLS_HOME环境变量或spring.devtools.home系统属性。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果在$HOME/.config/spring-boot中找不到devtools配置文件，则会在$HOME目录的根部搜索是否存在一个.spring-boot-devtools.properties文件。这允许你与那些不支持$HOME/.config/spring-boot位置的旧版Spring Boot上的应用程序共享devtools全局配置。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>devtools properties/yaml文件中不支持配置文件。</p>
</div>
<div class="paragraph">
<p>任何在.spring-boot-devtools.properties中激活的配置文件都不会影响配置文件的加载。不支持YAML和Properties文件中的profile特定文件名（形式为spring-boot-devtools-&lt;profile&gt;.properties）和spring.config.activated.on-profile文档。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>配置文件系统监视器</strong></p>
</div>
<div class="paragraph">
<p>FileSystemWatcher 的工作方式是以一定的时间间隔轮询类的变化，然后等待一个预定义的安静期，以确保不再有变化。由于Spring Boot完全依赖IDE编译并将文件复制到Spring Boot可以读取的位置，你可能会发现，有时devtools重新启动应用程序时，某些变化并没有得到反映。如果你经常观察到这样的问题，可以尝试增加spring.devtools.restart.poll-interval和spring.devtools.restart.quiet-period参数到适合你开发环境的值。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>spring.devtools.restart.poll-interval=2s

spring.devtools.restart.quiet-period=1s</pre>
</div>
</div>
<div class="paragraph">
<p>受监控的classpath目录现在每2秒轮询一次变化，并保持1秒的安静期以确保没有额外的类变化。</p>
</div>
</div>
<div class="sect3">
<h4 id="_远程应用程序"><a class="link" href="#_远程应用程序">6.8.6. 远程应用程序</a></h4>
<div class="paragraph">
<p>Spring Boot的开发者工具并不局限于本地开发。你也可以在远程运行应用程序时使用一些功能。远程支持是可选的，因为启用它可能会有安全风险。只有在受信任的网络上运行时，或在用SSL保护时，才应启用它。如果这两个选项对你来说都不可用，你就不应该使用DevTools的远程支持。你不应该在生产部署中启用支持。</p>
</div>
<div class="paragraph">
<p>要启用它，你需要确保devtools包含在重新打包的存档中，如下面的列表所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span style="color:#070;font-weight:bold">&lt;build&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;plugins&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;plugin&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#070;font-weight:bold">&lt;/groupId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span style="color:#070;font-weight:bold">&lt;/artifactId&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;configuration&gt;</span>
                <span style="color:#070;font-weight:bold">&lt;excludeDevtools&gt;</span>false<span style="color:#070;font-weight:bold">&lt;/excludeDevtools&gt;</span>
            <span style="color:#070;font-weight:bold">&lt;/configuration&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/plugin&gt;</span>
    <span style="color:#070;font-weight:bold">&lt;/plugins&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/build&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后你需要设置 spring.devtools.remote.secret 属性。就像任何重要的密码或秘密一样，这个值应该是唯一的和强大的，以至于不能被猜到或被暴力破解。</p>
</div>
<div class="paragraph">
<p>远程devtools支持由两部分组成：一个接受连接的服务器端端点和一个你在IDE中运行的客户端应用程序。当spring.devtools.remote.secret属性被设置时，服务器组件会自动启用。客户端组件必须手动启动。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Spring WebFlux应用程序不支持远程devtools。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>运行远程客户端应用程序</strong></p>
</div>
<div class="paragraph">
<p>远程客户端应用程序被设计为可在你的IDE中运行。你需要运行org.springframework.boot.devtools.RemoteSpringApplication，其classpath与你所连接的远程项目相同。该应用程序的唯一必要参数是它所连接的远程URL。</p>
</div>
<div class="paragraph">
<p>例如，如果您使用 Eclipse 或 Spring Tools，并且您有一个名为 my-app 的项目，并已将其部署到 Cloud Foundry，您可以执行以下操作。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select Run Configurations…​ from the Run menu.</p>
</li>
<li>
<p>Create a new Java Application “launch configuration”.</p>
</li>
<li>
<p>Browse for the my-app project.</p>
</li>
<li>
<p>Use org.springframework.boot.devtools.RemoteSpringApplication as the main class.</p>
</li>
<li>
<p>Add <a href="https://myapp.cfapps.io" class="bare">https://myapp.cfapps.io</a> to the Program arguments (or whatever your remote URL is).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A running remote client might resemble the following listing:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> .   ____          _                                              __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _          ___               _      \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` |        | _ \___ _ __  ___| |_ ___ \ \ \ \
 \\/  ___)| |_)| | | | | || (_| []::::::[]   / -_) '  \/ _ \  _/ -_) ) ) ) )
  '  |____| .__|_| |_|_| |_\__, |        |_|_\___|_|_|_\___/\__\___|/ / / /
 =========|_|==============|___/===================================/_/_/_/
 :: Spring Boot Remote :: 2.7.0

2015-06-10 18:25:06.632  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Starting RemoteSpringApplication on pwmbp with PID 14938 (/Users/pwebb/projects/spring-boot/code/spring-boot-project/spring-boot-devtools/target/classes started by pwebb in /Users/pwebb/projects/spring-boot/code)
2015-06-10 18:25:06.671  INFO 14938 --- [           main] s.c.a.AnnotationConfigApplicationContext : Refreshing org.springframework.context.annotation.AnnotationConfigApplicationContext@2a17b7b6: startup date [Wed Jun 10 18:25:06 PDT 2015]; root of context hierarchy
2015-06-10 18:25:07.043  WARN 14938 --- [           main] o.s.b.d.r.c.RemoteClientConfiguration    : The connection to http://localhost:8080 is insecure. You should use a URL starting with 'https://'.
2015-06-10 18:25:07.074  INFO 14938 --- [           main] o.s.b.d.a.OptionalLiveReloadServer       : LiveReload server is running on port 35729
2015-06-10 18:25:07.130  INFO 14938 --- [           main] o.s.b.devtools.RemoteSpringApplication   : Started RemoteSpringApplication in 0.74 seconds (JVM running for 1.105)</pre>
</div>
</div>
<div class="paragraph">
<p>因为远程客户端使用的是与真实应用程序相同的classpath，它可以直接读取应用程序属性。这就是spring.devtools.remote.secret属性被读取并传递给服务器进行验证的方式。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_为生产环境打包应用"><a class="link" href="#_为生产环境打包应用">6.9. 为生产环境打包应用</a></h3>
<div class="paragraph">
<p>可执行的jar可以用于生产部署。由于它们是独立的，它们也非常适合于基于云的部署。</p>
</div>
<div class="paragraph">
<p>对于额外的 "生产就绪 "功能，如健康、审计和度量REST或JMX端点，考虑添加spring-boot-actuator。详见生产就绪的功能。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_核心功能"><a class="link" href="#_核心功能">7. 核心功能</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>本节深入介绍了Spring Boot的细节。在这里，你可以了解到你可能想要使用和定制的关键功能。如果你还没有这样做，你可能想阅读 "入门 "和 "使用Spring Boot开发 "部分，这样你就有了良好的基础知识。</p>
</div>
<div class="sect2">
<h3 id="_spring_application"><a class="link" href="#_spring_application">7.1. spring application</a></h3>
<div class="paragraph">
<p>SpringApplication类提供了一种方便的方式来引导从main()方法中启动的Spring应用程序。在许多情况下，你可以委托给静态的SpringApplication.run方法，如下面的例子中所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication.run(MyApplication.class, args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当你的应用程序启动时，你应该看到类似于以下的输出。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::   v2.7.0

2021-02-03 10:33:25.224  INFO 17321 --- [           main] o.s.b.d.s.s.SpringApplicationExample    : Starting SpringApplicationExample using Java 1.8.0_232 on mycomputer with PID 17321 (/apps/myjar.jar started by pwebb)
2021-02-03 10:33:25.226  INFO 17900 --- [           main] o.s.b.d.s.s.SpringApplicationExample    : No active profile set, falling back to default profiles: default
2021-02-03 10:33:26.046  INFO 17321 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2021-02-03 10:33:26.054  INFO 17900 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2021-02-03 10:33:26.055  INFO 17900 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.41]
2021-02-03 10:33:26.097  INFO 17900 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2021-02-03 10:33:26.097  INFO 17900 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 821 ms
2021-02-03 10:33:26.144  INFO 17900 --- [           main] s.tomcat.SampleTomcatApplication         : ServletContext initialized
2021-02-03 10:33:26.376  INFO 17900 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2021-02-03 10:33:26.384  INFO 17900 --- [           main] o.s.b.d.s.s.SpringApplicationExample    : Started SampleTomcatApplication in 1.514 seconds (JVM running for 1.823)</pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，会显示INFO日志信息，包括一些相关的启动细节，比如启动应用程序的用户。如果你需要一个INFO以外的日志级别，你可以设置它，如日志级别中所述。应用程序的版本是通过主应用程序类的包的实现版本来确定的。可以通过设置spring.main.log-startup-info为false来关闭启动信息记录。这也将关闭应用程序的活动配置文件的日志记录。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>为了在启动过程中增加额外的日志记录，你可以在SpringApplication的子类中覆盖logStartupInfo(boolean)。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_启动失败"><a class="link" href="#_启动失败">7.1.1. 启动失败</a></h4>
<div class="paragraph">
<p>如果你的应用程序无法启动，注册的FailureAnalyzers就有机会提供一个专门的错误信息和一个具体的行动来解决问题。例如，如果你在8080端口上启动一个网络应用，而该端口已经被使用，你应该看到类似于下面的消息。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>***************************
APPLICATION FAILED TO START
***************************

Description:

Embedded servlet container failed to start. Port 8080 was already in use.

Action:

Identify and stop the process that is listening on port 8080 or configure this application to listen on another port.</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Spring Boot提供了许多FailureAnalyzer实现，你也可以添加自己的。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>如果没有故障分析器能够处理异常，你仍然可以显示完整的条件报告以更好地了解出错的原因。要做到这一点，你需要为org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener启用调试属性或启用DEBUG日志。</p>
</div>
<div class="paragraph">
<p>例如，如果你通过使用java -jar来运行你的应用程序，你可以启用调试属性，如下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar myproject-0.0.1-SNAPSHOT.jar --debug</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_懒加载"><a class="link" href="#_懒加载">7.1.2. 懒加载</a></h4>
<div class="paragraph">
<p>SpringApplication允许应用程序被懒加载。当懒加载启用时，Bean会在需要时被创建，而不是在应用程序启动时。因此，启用懒加载可以减少应用程序的启动时间。在一个Web应用程序中，启用懒加载将导致许多与Web相关的Bean在收到HTTP请求之前不会被初始化。</p>
</div>
<div class="paragraph">
<p>懒加载的一个缺点是，它可以延迟发现应用程序的问题。如果一个配置错误的Bean懒加载了，那么在启动过程中就不会再出现故障，问题只有在Bean被初始化时才会显现出来。还必须注意确保JVM有足够的内存来容纳应用程序的所有Bean，而不仅仅是那些在启动期间被初始化的Bean。由于这些原因，默认情况下不启用懒加载，建议在启用懒加载之前对JVM的堆大小进行微调。</p>
</div>
<div class="paragraph">
<p>懒加载可以通过SpringApplicationBuilder的lazyInitialization方法或SpringApplication的setLazyInitialization方法以编程方式启用。另外，也可以使用spring.main.lazy-initialization属性来启用，如下例所示。</p>
</div>
<div class="paragraph">
<p><code>
spring.main.lazy-initialization=true
</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你想禁用某些Bean的懒加载，而对应用程序的其他部分使用懒加载，你可以使用@Lazy(false)注解将它们的懒加载属性明确地设置为false。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_定制banner"><a class="link" href="#_定制banner">7.1.3. 定制Banner</a></h4>
<div class="paragraph">
<p>启动时打印的标语可以通过在classpath中添加banner.txt文件或将spring.banner.location属性设置为此类文件的位置来改变。如果该文件的编码不是UTF-8，你可以设置spring.banner.charset。除了文本文件外，你还可以在classpath中添加banner.gif、banner.jpg或banner.png图像文件，或者设置spring.banner.image.location属性。图像被转换成ASCII艺术表现形式，并打印在任何文本横幅之上。</p>
</div>
<div class="paragraph">
<p>在你的banner.txt文件中，你可以使用环境中可用的任何键，以及以下任何占位符。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">占位符</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${application.version}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">你的应用程序的版本号，如MANIFEST.MF中所声明的。例如，Implementation-Version: 1.0被打印为1.0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${application.formatted-version}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">你的应用程序的版本号，正如在MANIFEST.MF中声明的那样，并以格式化的方式显示（用括号包围，以v为前缀）。例如（v1.0）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${spring-boot.version}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">你正在使用的Spring Boot版本。例如，2.7.0。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${spring-boot.formatted-version}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">您正在使用的Spring Boot版本，格式化显示（用括号包围，以v为前缀）。例如（v2.7.0）。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${Ansi.NAME} (or </p>
<p class="tableblock">${AnsiColor.NAME}, </p>
<p class="tableblock">${AnsiBackground.NAME}, </p>
<p class="tableblock">${AnsiStyle.NAME})</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">其中NAME是一个ANSI转义代码的名称。详见AnsiPropertySource。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">${application.title}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">你的应用程序的标题，如MANIFEST.MF中声明的那样。例如，实施-标题。MyApp被打印为MyApp。</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你想以编程方式生成一个横幅，可以使用SpringApplication.setBanner(..)方法。使用org.springframework.boot.Banner接口并实现你自己的printBanner()方法。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>你还可以使用spring.main.banner-mode属性来决定横幅是否必须打印在System.out上（console），发送至配置的记录器（log），或者根本不产生（off）。</p>
</div>
<div class="paragraph">
<p>打印的横幅被注册为一个单子Bean，名称如下：springBootBanner。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>${application.version}和${application.formatted-version}属性仅在您使用Spring Boot启动器时可用。如果您运行一个未打包的jar并使用java -cp &lt;classpath&gt; &lt;mainclass&gt;启动它，这些值将不会被解决。</p>
</div>
<div class="paragraph">
<p>这就是为什么我们建议你总是使用java org.springframework.boot.loader.JarLauncher来启动未打包的jar。这将在构建classpath和启动你的应用程序之前初始化application.* banner变量。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_定制spirngbottapplication"><a class="link" href="#_定制spirngbottapplication">7.1.4. 定制SpirngBottApplication</a></h4>
<div class="paragraph">
<p>如果SpringApplication的默认值不符合你的口味，你可以创建一个本地实例并对其进行自定义。例如，要关闭横幅，你可以这样写。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.Banner</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication application = <span style="color:#080;font-weight:bold">new</span> SpringApplication(MyApplication.class);
        application.setBannerMode(Banner.Mode.OFF);
        application.run(args);
    }

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>传递给SpringApplication的构造函数参数是Spring Bean的配置源。在大多数情况下，这些是对@Configuration类的引用，但它们也可以直接引用@Component类。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>也可以通过使用application.properties文件来配置SpringApplication。详见外部化配置。</p>
</div>
<div class="paragraph">
<p>关于配置选项的完整列表，请参见SpringApplication Javadoc。</p>
</div>
</div>
<div class="sect3">
<h4 id="_流式构造api"><a class="link" href="#_流式构造api">7.1.5. 流式构造API</a></h4>
<div class="paragraph">
<p>如果你需要建立一个ApplicationContext层次结构（具有父/子关系的多个上下文），或者你更喜欢使用 "流"构建器API，你可以使用SpringApplicationBuilder。</p>
</div>
<div class="paragraph">
<p>SpringApplicationBuilder让你把多个方法调用串联起来，并包括父子方法，让你创建一个层次结构，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">new</span> SpringApplicationBuilder()
        .sources(Parent.class)
        .child(Application.class)
        .bannerMode(Banner.Mode.OFF)
        .run(args);</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在创建 ApplicationContext 层次结构时有一些限制。例如，Web组件必须包含在子上下文中，而且父上下文和子上下文都使用相同的环境。详细内容请参见SpringApplicationBuilder Javadoc。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_应用可用性"><a class="link" href="#_应用可用性">7.1.6. 应用可用性</a></h4>
<div class="paragraph">
<p>在平台上部署时，应用程序可以使用Kubernetes Probes等基础设施向平台提供有关其可用性的信息。Spring Boot包括对常用的 "liveness "和 "readiness "可用性状态的开箱即用的支持。如果你使用Spring Boot的 "执行器 "支持，那么这些状态将作为健康端点组暴露出来。</p>
</div>
<div class="paragraph">
<p>此外，你还可以通过将ApplicationAvailability接口注入到你自己的Bean中来获得可用性状态。</p>
</div>
<div class="paragraph">
<p><strong>存活状态</strong></p>
</div>
<div class="paragraph">
<p>一个应用程序的 "Liveness "状态告诉我们它的内部状态是否允许它正常工作，或者在当前失败的情况下自行恢复。一个破碎的 "Liveness "状态意味着应用程序处于无法恢复的状态，基础设施应该重新启动该应用程序。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>一般来说，"Liveness "状态不应该基于外部检查，比如健康检查。如果是这样，一个失败的外部系统（数据库、Web API、外部缓存）会引发整个平台的大规模重启和级联故障。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Spring Boot应用程序的内部状态大多由Spring ApplicationContext表示。如果应用程序上下文已成功启动，Spring Boot就认为应用程序处于有效状态。一旦上下文被刷新，应用程序就被认为是活的，见Spring Boot应用程序生命周期和相关应用程序事件。</p>
</div>
<div class="paragraph">
<p><strong>预备状态</strong></p>
</div>
<div class="paragraph">
<p>一个应用程序的 "准备就绪 "状态告诉人们该应用程序是否准备好处理流量。失败的 "准备就绪 "状态告诉平台，它暂时不应该将流量发送到该应用程序。这通常发生在启动期间，当CommandLineRunner和ApplicationRunner组件被处理时，或者在任何时候，如果应用程序决定它对额外的流量太忙。</p>
</div>
<div class="paragraph">
<p>一旦应用程序和命令行运行器被调用，就认为应用程序已经准备好了，见Spring Boot应用程序生命周期和相关应用程序事件。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>预计在启动期间运行的任务应该由CommandLineRunner和ApplicationRunner组件执行，而不是使用Spring组件的生命周期回调，如@PostConstruct。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>管理应用程序的可用性状态</strong></p>
</div>
<div class="paragraph">
<p>应用程序组件可以通过注入ApplicationAvailability接口并调用其上的方法，在任何时候检索当前的可用性状态。更多时候，应用程序会想要监听状态更新或更新应用程序的状态。</p>
</div>
<div class="paragraph">
<p>例如，我们可以把应用程序的 "准备就绪 "状态导出到一个文件，这样Kubernetes的 "exec Probe "就可以查看这个文件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.availability.AvailabilityChangeEvent</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.availability.ReadinessState</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.event.EventListener</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Component</span>;

<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyReadinessStateExporter</span> {

    <span style="color:#007">@EventListener</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> onStateChange(AvailabilityChangeEvent&lt;ReadinessState&gt; event) {
        <span style="color:#080;font-weight:bold">switch</span> (event.getState()) {
        <span style="color:#080;font-weight:bold">case</span> ACCEPTING_TRAFFIC:
            <span style="color:#777">// create file /tmp/healthy</span>
            <span style="color:#080;font-weight:bold">break</span>;
        <span style="color:#080;font-weight:bold">case</span> REFUSING_TRAFFIC:
            <span style="color:#777">// remove file /tmp/healthy</span>
            <span style="color:#080;font-weight:bold">break</span>;
        }
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>我们还可以更新应用程序的状态，当应用程序中断而无法恢复时。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.availability.AvailabilityChangeEvent</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.availability.LivenessState</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.ApplicationEventPublisher</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Component</span>;

<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyLocalCacheVerifier</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> ApplicationEventPublisher eventPublisher;

    <span style="color:#088;font-weight:bold">public</span> MyLocalCacheVerifier(ApplicationEventPublisher eventPublisher) {
        <span style="color:#950">this</span>.eventPublisher = eventPublisher;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> checkLocalCache() {
        <span style="color:#080;font-weight:bold">try</span> {
            <span style="color:#777">// ...</span>
        }
        <span style="color:#080;font-weight:bold">catch</span> (CacheCompletelyBrokenException ex) {
            AvailabilityChangeEvent.publish(<span style="color:#950">this</span>.eventPublisher, ex, LivenessState.BROKEN);
        }
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_应用程序事件和监听器"><a class="link" href="#_应用程序事件和监听器">7.1.7. 应用程序事件和监听器</a></h4>
<div class="paragraph">
<p>除了常见的Spring框架事件，如ContextRefreshedEvent，SpringApplication还会发送一些额外的应用事件。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>有些事件实际上是在ApplicationContext创建之前被触发的，所以你不能以@Bean的形式为这些事件注册一个监听器。你可以用SpringApplication.addListeners(&#8230;&#8203;)方法或SpringApplicationBuilder.listeners(&#8230;&#8203;)方法注册它们。
如果你希望这些监听器被自动注册，无论应用程序是以何种方式创建的，你可以在你的项目中添加一个META-INF/spring.plants文件，并通过使用org.springframework.context.ApplicationListener键来引用你的监听器，如下面的例子中所示。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>org.springframework.context.ApplicationListener=com.example.project.MyListener</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>当你的应用程序运行时，应用程序事件按以下顺序发送：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ApplicationStartingEvent在运行开始时被发送，但在任何处理之前，除了监听器和初始化器的注册之外。</p>
</li>
<li>
<p>当已知将在上下文中使用的环境，但在创建上下文之前，将发送一个ApplicationEnvironmentPreparedEvent。</p>
</li>
<li>
<p>当 ApplicationContext 被准备好并且 ApplicationContextInitializers 被调用，但在任何 bean 定义被加载之前，ApplicationContextInitializedEvent 被发送。</p>
</li>
<li>
<p>ApplicationPreparedEvent在刷新开始前但在Bean定义被加载后被发送。</p>
</li>
<li>
<p>ApplicationStartedEvent在上下文被刷新之后，但在任何应用程序和命令行运行程序被调用之前被发送。</p>
</li>
<li>
<p>紧接着发送一个可用性变化事件（AvailabilityChangeEvent），并注明LivenessState.CORRECT，以表明应用程序被认为是有效的。</p>
</li>
<li>
<p>ApplicationReadyEvent在任何应用程序和命令行运行程序被调用之后被发送。</p>
</li>
<li>
<p>紧接着发送一个带有ReadinessState.ACCEPTING_TRAFFIC的AvailabilityChangeEvent，以表明应用程序已经准备好为请求提供服务。</p>
</li>
<li>
<p>如果在启动时出现异常，将发送一个ApplicationFailedEvent。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>上面的列表只包括与SpringApplication绑定的SpringApplicationEvents。除此以外，以下事件也会在ApplicationPreparedEvent之后和ApplicationStartedEvent之前发布。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebServerInitializedEvent是在WebServer准备好后发送的。ServletWebServerInitializedEvent和ReactiveWebServerInitializedEvent分别是Servlet和reactive的变体。</p>
</li>
<li>
<p>当ApplicationContext被刷新时，会发送一个ContextRefreshedEvent。</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你通常不需要使用应用程序事件，但知道它们的存在会很方便。在内部，Spring Boot使用事件来处理各种任务。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>事件监听器不应该运行潜在的冗长任务，因为它们默认是在同一个线程中执行。考虑使用应用程序和命令行运行器来代替。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>应用程序事件是通过使用Spring框架的事件发布机制来发送的。这种机制的一部分是确保发布给子上下文中的监听器的事件也会发布给任何祖先上下文中的监听器。因此，如果你的应用程序使用SpringApplication实例的层次结构，一个监听器可能会收到同一类型应用程序事件的多个实例。</p>
</div>
<div class="paragraph">
<p>为了让你的监听器能够区分其上下文的事件和后代上下文的事件，它应该请求其应用程序上下文被注入，然后将注入的上下文与事件的上下文进行比较。上下文可以通过实现ApplicationContextAware来注入，或者，如果监听器是一个Bean，可以通过使用@Autowired来注入。</p>
</div>
</div>
<div class="sect3">
<h4 id="_web环境"><a class="link" href="#_web环境">7.1.8. web环境</a></h4>
<div class="paragraph">
<p>一个SpringApplication试图代表你创建正确类型的ApplicationContext。用来确定WebApplicationType的算法如下。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果有Spring MVC，就会使用AnnotationConfigServletWebServerApplicationContext。</p>
</li>
<li>
<p>如果不存在Spring MVC而存在Spring WebFlux，就会使用AnnotationConfigReactiveWebServerApplicationContext。</p>
</li>
<li>
<p>否则，将使用AnnotationConfigApplicationContext。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这意味着，如果你在同一个应用程序中使用Spring MVC和Spring WebFlux的新WebClient，Spring MVC将被默认使用。你可以通过调用setWebApplicationType(WebApplicationType)轻松地覆盖这一点。</p>
</div>
<div class="paragraph">
<p>也可以通过调用setApplicationContextClass(&#8230;&#8203;)来完全控制使用的ApplicationContext类型。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>当在JUnit测试中使用SpringApplication时，通常需要调用setWebApplicationType(WebApplicationType.NONE)。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_访问应用程序的参数"><a class="link" href="#_访问应用程序的参数">7.1.9. 访问应用程序的参数</a></h4>
<div class="paragraph">
<p>如果你需要访问传递给SpringApplication.run(&#8230;&#8203;)的应用程序参数，你可以注入一个org.springframework.boot.ApplicationArguments Bean。ApplicationArguments接口提供了对原始的String[]参数以及经过解析的选项和非选项参数的访问，如下面的例子中所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.List</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.ApplicationArguments</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Component</span>;

<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBean</span> {

    <span style="color:#088;font-weight:bold">public</span> MyBean(ApplicationArguments args) {
        <span style="color:#339;font-weight:bold">boolean</span> debug = args.containsOption(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">debug</span><span style="color:#710">&quot;</span></span>);
        <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; files = args.getNonOptionArgs();
        <span style="color:#080;font-weight:bold">if</span> (debug) {
            <span style="color:#0a8;font-weight:bold">System</span>.out.println(files);
        }
        <span style="color:#777">// if run with &quot;--debug logfile.txt&quot; prints [&quot;logfile.txt&quot;]</span>
    }

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Spring Boot还向Spring环境注册了一个CommandLinePropertySource。这让你也可以通过使用@Value注解来注入单个应用参数。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用_applicationrunner_或_commandlinerunner"><a class="link" href="#_使用_applicationrunner_或_commandlinerunner">7.1.10. 使用 ApplicationRunner 或 CommandLineRunner</a></h4>
<div class="paragraph">
<p>如果你需要在SpringApplication启动后运行一些特定的代码，你可以实现ApplicationRunner或CommandLineRunner接口。这两个接口的工作方式相同，并提供一个单一的运行方法，该方法在SpringApplication.run(&#8230;&#8203;)完成之前被调用。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>这个合同很适合那些应该在应用程序启动后但在其开始接受流量之前运行的任务。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>CommandLineRunner接口提供了对作为字符串数组的应用程序参数的访问，而ApplicationRunner使用前面讨论的ApplicationArguments接口。下面的例子显示了一个带有运行方法的CommandLineRunner。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.CommandLineRunner</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Component</span>;

<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyCommandLineRunner</span> <span style="color:#088;font-weight:bold">implements</span> CommandLineRunner {

    <span style="color:#007">@Override</span>
    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> run(<span style="color:#0a8;font-weight:bold">String</span>... args) {
        <span style="color:#777">// Do something...</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果定义了几个必须以特定顺序调用的CommandLineRunner或ApplicationRunner Bean，你可以额外实现org.springframework.core.Ordered接口或使用org.springframework.core.annotation.Order注解。</p>
</div>
</div>
<div class="sect3">
<h4 id="_应用程序退出"><a class="link" href="#_应用程序退出">7.1.11. 应用程序退出</a></h4>
<div class="paragraph">
<p>每个SpringApplication都向JVM注册了一个关闭钩，以确保ApplicationContext在退出时优雅地关闭。所有标准的Spring生命周期回调（如DisposableBean接口或@PreDestroy注解）都可以被使用。</p>
</div>
<div class="paragraph">
<p>此外，如果Bean希望在SpringApplication.exit()被调用时返回一个特定的退出代码，它们可以实现org.springframework.boot.ExitCodeGenerator接口。然后，这个退出代码可以被传递给System.exit()，将其作为状态代码返回，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.ExitCodeGenerator</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.annotation.Bean</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#007">@Bean</span>
    <span style="color:#088;font-weight:bold">public</span> ExitCodeGenerator exitCodeGenerator() {
        <span style="color:#080;font-weight:bold">return</span> () -&gt; <span style="color:#00D">42</span>;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        <span style="color:#0a8;font-weight:bold">System</span>.exit(SpringApplication.exit(SpringApplication.run(MyApplication.class, args)));
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，ExitCodeGenerator接口可以由异常实现。当遇到这种异常时，Spring Boot会返回由实现的getExitCode()方法提供的退出代码。</p>
</div>
<div class="paragraph">
<p>如果有多个ExitCodeGenerator，则使用第一个生成的非零退出代码。要控制生成器的调用顺序，可以另外实现org.springframework.core.Ordered接口或使用org.springframework.core.annotation.Order注解。</p>
</div>
</div>
<div class="sect3">
<h4 id="_管理特性"><a class="link" href="#_管理特性">7.1.12. 管理特性</a></h4>
<div class="paragraph">
<p>通过指定spring.application.admin.enabled属性，可以启用应用程序的管理相关功能。这暴露了平台MBeanServer上的SpringApplicationAdminMXBean。你可以使用这个功能来远程管理你的Spring Boot应用程序。这个功能对任何服务封装器的实现也很有用。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你想知道应用程序是在哪个HTTP端口上运行的，可以用local.server.port的键来获取该属性。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_应用程序启动跟踪"><a class="link" href="#_应用程序启动跟踪">7.1.13. 应用程序启动跟踪</a></h4>
<div class="paragraph">
<p>在应用程序的启动过程中，SpringApplication和ApplicationContext执行许多与应用程序生命周期、Bean生命周期甚至处理应用程序事件有关的任务。通过ApplicationStartup，Spring框架允许你用StartupStep对象跟踪应用程序的启动顺序。这些数据可以为分析目的而收集，或者只是为了更好地了解应用程序的启动过程。</p>
</div>
<div class="paragraph">
<p>你可以在设置SpringApplication实例时选择一个ApplicationStartup实现。例如，要使用BufferingApplicationStartup，你可以这样写。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.SpringApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.autoconfigure.SpringBootApplication</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.metrics.buffering.BufferingApplicationStartup</span>;

<span style="color:#007">@SpringBootApplication</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyApplication</span> {

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> main(<span style="color:#0a8;font-weight:bold">String</span><span style="color:#339;font-weight:bold">[]</span> args) {
        SpringApplication application = <span style="color:#080;font-weight:bold">new</span> SpringApplication(MyApplication.class);
        application.setApplicationStartup(<span style="color:#080;font-weight:bold">new</span> BufferingApplicationStartup(<span style="color:#00D">2048</span>));
        application.run(args);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>第一个可用的实现，FlightRecorderApplicationStartup是由Spring框架提供的。它将Spring特有的启动事件添加到Java Flight Recorder会话中，旨在对应用程序进行分析，并将其Spring上下文生命周期与JVM事件（如分配、GC、类加载&#8230;&#8203;&#8230;&#8203;）联系起来。一旦配置好，你就可以通过启用Flight Recorder运行应用程序来记录数据。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ java -XX:StartFlightRecording:filename=recording.jfr,duration=10s -jar demo.jar</pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot提供了BufferingApplicationStartup变体；该实现是为了缓冲启动步骤，并将其排入外部度量系统。应用程序可以在任何组件中要求获得BufferingApplicationStartup类型的bean。</p>
</div>
<div class="paragraph">
<p>Spring Boot也可以被配置为公开一个启动端点，以JSON文档的形式提供这一信息。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_外部化配置"><a class="link" href="#_外部化配置">7.2. 外部化配置</a></h3>
<div class="paragraph">
<p>Spring Boot让你将配置外部化，这样你就可以在不同的环境中使用相同的应用程序代码。你可以使用各种外部配置源，包括Java属性文件、YAML文件、环境变量和命令行参数。</p>
</div>
<div class="paragraph">
<p>属性值可以通过使用@Value注解直接注入你的Bean，通过Spring的环境抽象访问，或者通过@ConfigurationProperties绑定到结构化对象。</p>
</div>
<div class="paragraph">
<p>Spring Boot使用了一种非常特殊的PropertySource顺序，旨在允许合理地重写值。属性是按以下顺序考虑的（较晚项目的值会覆盖较早项目的值）。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>默认属性（通过SpringApplication.setDefaultProperties）</p>
</li>
<li>
<p>@Configuration类上的@PropertySource注解。请注意，这样的属性源直到应用程序上下文被刷新时才会被添加到环境中。这对于配置某些属性来说已经太晚了，比如logging.* 和spring.main.*，它们在刷新开始前就已经被读取了。</p>
</li>
<li>
<p>配置数据（如application.properties文件）。</p>
</li>
<li>
<p>一个RandomValuePropertySource，它的属性只在随机.*。</p>
</li>
<li>
<p>操作系统环境变量。</p>
</li>
<li>
<p>Java系统属性（System.getProperties()）。</p>
</li>
<li>
<p>JNDI属性来自java:comp/env。</p>
</li>
<li>
<p>ServletContext初始参数。</p>
</li>
<li>
<p>ServletConfig 初始参数</p>
</li>
<li>
<p>来自SPRING_APPLICATION_JSON的属性（嵌入环境变量或系统属性中的内联JSON）。</p>
</li>
<li>
<p>命令行参数</p>
</li>
<li>
<p>properties在你的测试上。在@SpringBootTest和测试注解中可用，用于测试你的应用程序的一个特定片断。</p>
</li>
<li>
<p>测试中的@TestPropertySource注解</p>
</li>
<li>
<p>当devtools处于活动状态时，$HOME/.config/spring-boot目录下的Devtools全局设置属性。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>配置数据文件按以下顺序考虑。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在jar包中的application.properties 或者 yml</p>
</li>
<li>
<p>jar包外的特定application-xxx.properties 或者 yml</p>
</li>
<li>
<p>在你打的jar包之外的application.properties 或者 yml</p>
</li>
<li>
<p>在你打的jar包之外的特定application-xxx.properties 或者 yml</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>建议在你的整个应用程序中坚持使用一种格式。如果你在同一地点有.properties和.yml格式的配置文件，那么.properties优先考虑。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>为了提供一个具体的例子，假设你开发了一个使用name属性的@Component，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.beans.factory.annotation.Value</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Component</span>;

<span style="color:#007">@Component</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyBean</span> {

    <span style="color:#007">@Value</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">${name}</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> name;

    <span style="color:#777">// ...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在你的应用程序的classpath（例如，在你的jar中），你可以有一个application.properties文件，为name提供一个合理的默认属性值。当在一个新的环境中运行时，可以在你的jar之外提供一个application.properties文件来覆盖名称。对于一次性的测试，你可以用一个特定的命令行开关来启动（例如，java -jar app.jar --name="Spring"）。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>env和configprops端点在确定一个属性为什么有一个特定的值时非常有用。你可以使用这两个端点来诊断意外的属性值。详见 "生产就绪功能 "部分。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_命令行属性"><a class="link" href="#_命令行属性">7.2.1. 命令行属性</a></h4>
<div class="paragraph">
<p>默认情况下，SpringApplication会将任何命令行选项参数（即以&#8212;&#8203;开头的参数，如&#8212;&#8203;server.port=9000）转换为属性并将其添加到Spring环境中。如前所述，命令行属性总是优先于基于文件的属性源。</p>
</div>
<div class="paragraph">
<p>如果你不希望命令行属性被添加到环境中，你可以通过使用SpringApplication.setAddCommandLineProperties(false)禁用它们。</p>
</div>
</div>
<div class="sect3">
<h4 id="_json属性"><a class="link" href="#_json属性">7.2.2. JSON属性</a></h4>
<div class="paragraph">
<p>环境变量和系统属性往往有限制，这意味着有些属性名称不能使用。为了帮助解决这个问题，Spring Boot允许你将一个属性块编码为一个单一的JSON结构。</p>
</div>
<div class="paragraph">
<p>当你的应用程序启动时，任何spring.application.json或SPRING_APPLICATION_JSON属性将被解析并添加到环境中。</p>
</div>
<div class="paragraph">
<p>例如，SPRING_APPLICATION_JSON属性可以作为环境变量在UN*X shell的命令行中提供。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ SPRING_APPLICATION_JSON='{"my":{"name":"test"}}' java -jar myapp.jar</pre>
</div>
</div>
<div class="paragraph">
<p>在前面的例子中，你在Spring环境中最终得到了my.name=test。</p>
</div>
<div class="paragraph">
<p>同样的JSON也可以作为一个系统属性提供。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -Dspring.application.json='{"my":{"name":"test"}}' -jar myapp.jar</pre>
</div>
</div>
<div class="paragraph">
<p>或者你可以通过使用一个命令行参数来提供JSON。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar myapp.jar --spring.application.json='{"my":{"name":"test"}}'</pre>
</div>
</div>
<div class="paragraph">
<p>如果你要部署到一个经典的应用服务器，你也可以使用一个JNDI变量，名为
<code>java:comp/env/spring.application.json.</code></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>尽管JSON中的空值将被添加到产生的属性源中，但PropertySourcesPropertyResolver将空属性视为缺失值。这意味着JSON不能用一个空值覆盖来自低阶属性源的属性。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_外部applicationpreperties"><a class="link" href="#_外部applicationpreperties">7.2.3. 外部ApplicationPreperties</a></h4>
<div class="paragraph">
<p>当你的应用程序启动时，Spring Boot会自动从以下位置找到并加载application.properties和application.yaml文件。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>classpath下</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>classpath跟目录</p>
</li>
<li>
<p>classpath下的/config文件夹中</p>
</li>
</ol>
</div>
</li>
<li>
<p>当前目录</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>当前目录下</p>
</li>
<li>
<p>当前目录的/config目录中</p>
</li>
<li>
<p>/config目录的直接子目录</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>列表按优先级排序（较晚项目的值覆盖较早项目的值）。加载文件中的文件被作为PropertySources添加到Spring环境中。</p>
</div>
<div class="paragraph">
<p>如果你不喜欢application作为配置文件名称，你可以通过指定spring.config.name环境属性切换到另一个文件名称。例如，为了寻找 myproject.properties 和 myproject.yaml 文件，你可以按以下方式运行你的应用程序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java -jar myproject.jar --spring.config.name=myproject</pre>
</div>
</div>
<div class="paragraph">
<p>你也可以通过使用spring.config.location环境属性来引用一个明确的位置。该属性接受一个逗号分隔的列表，其中包含一个或多个要检查的位置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ java -jar myproject.jar --spring.config.location=\
    optional:classpath:/default.properties,\
    optional:classpath:/override.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果位置是可选的，并且你不介意它们不存在，则使用前缀 optional: 。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>spring.config.name、spring.config.location和spring.config.extra-location很早就用来确定哪些文件必须被加载。它们必须被定义为环境属性（通常是操作系统环境变量、系统属性或命令行参数）。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>如果spring.config.location包含目录（而不是文件），它们应该以/结尾。在运行时，它们在被加载之前将被附加上由spring.config.name生成的名称。在spring.config.location中指定的文件会被直接导入。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>目录和文件位置值也被扩展，以检查特定的配置文件。例如，如果你的spring.config.location是classpath:myconfig.properties，你也会发现适当的classpath:myconfig-&lt;profile&gt;.properties文件被加载。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>在大多数情况下，你添加的每个spring.config.location项目将引用一个文件或目录。位置是按照定义的顺序来处理的，后面的位置可以覆盖前面的位置的值。</p>
</div>
<div class="paragraph">
<p>如果你有一个复杂的位置设置，而且你使用特定的配置文件，你可能需要提供进一步的提示，以便Spring Boot知道它们应该如何分组。一个位置组是一个位置的集合，这些位置都被认为是在同一级别。例如，你可能想把所有classpath位置分组，然后是所有外部位置。一个位置组内的项目应该用;分隔。更多细节见 <a href="#特定配置文件">[特定配置文件]</a>一节中的例子。</p>
</div>
<div class="paragraph">
<p>通过使用spring.config.location配置的位置取代默认位置。例如，如果spring.config.location的配置值为optional:classpath:/custom-config/,optional:file:./custom-config/，则考虑的完整位置集为。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>optional:classpath:custom-config/</code></p>
</li>
<li>
<p><code>optional:file:./custom-config/</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果你喜欢添加额外的位置，而不是替换它们，你可以使用spring.config.extra-location。从附加位置加载的属性可以覆盖默认位置的属性。例如，如果spring.config.extra-location的配置值为optional:classpath:/custom-config/,optional:file:./custom-config/，则考虑的完整位置集为。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>optional:classpath:/;optional:classpath:/config/</code></p>
</li>
<li>
<p><code>optional:file:./;optional:file:./config/;optional:file:./config/*/</code></p>
</li>
<li>
<p><code>optional:classpath:custom-config/</code></p>
</li>
<li>
<p><code>optional:file:./custom-config/</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这种搜索排序让你在一个配置文件中指定默认值，然后在另一个文件中选择性地覆盖这些值。你可以在默认位置之一的application.properties（或你用spring.config.name选择的任何其他基础名称）中为你的应用程序提供默认值。这些默认值可以在运行时用位于自定义位置之一的不同文件来覆盖。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你使用环境变量而不是系统属性，大多数操作系统不允许使用句点分隔的键名，但你可以使用下划线代替（例如，SPRING_CONFIG_NAME代替spring.config.name）。详情请参见 "从环境变量绑定"。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你的应用程序在servlet容器或应用服务器中运行，那么JNDI属性（在java:comp/env中）或servlet上下文初始化参数可以代替环境变量或系统属性，或者与之一样。</p>
</div>
</div>
</div>
<div id="Location的optional属性" class="paragraph">
<p><strong>Location的optional属性</strong></p>
</div>
<div class="paragraph">
<p>默认情况下，当指定的配置数据位置不存在时，Spring Boot将抛出ConfigDataLocationNotFoundException，你的应用程序将无法启动。</p>
</div>
<div class="paragraph">
<p>如果你想指定一个位置，但你不介意它并不总是存在，你可以使用<code>optional</code> 作为前缀。你可以在spring.config.location和spring.config.extra-location属性中使用这个前缀，也可以在spring.config.import声明中使用。</p>
</div>
<div class="paragraph">
<p>例如，spring.config.import的值为optional:file:./myconfig.properties，允许你的应用程序启动，即使myconfig.properties文件丢失。</p>
</div>
<div class="paragraph">
<p>如果你想忽略所有的ConfigDataLocationNotFoundExceptions并始终继续启动你的应用程序，你可以使用spring.config.on-not-found属性。使用SpringApplication.setDefaultProperties(&#8230;&#8203;)或用系统/环境变量来设置忽略的值。</p>
</div>
<div id="通配符位置" class="paragraph">
<p><strong>通配符位置</strong></p>
</div>
<div class="paragraph">
<p>如果一个配置文件的位置包括最后一个路径段的*字符，它被认为是一个通配符位置。通配符在配置被加载时被扩展，所以直接的子目录也被检查。通配符位置在Kubernetes这样的环境中特别有用，因为有多种来源的配置属性。</p>
</div>
<div class="paragraph">
<p>例如，如果你有一些 Redis 配置和一些 MySQL 配置，你可能想把这两块配置分开，同时要求这两块都存在于 application.properties 文件中。这可能会导致两个独立的application.properties文件挂载在不同的位置，如/config/redis/application.properties和/config/mysql/application.properties。在这种情况下，拥有 config/*/ 的通配符位置，将导致两个文件都被处理。</p>
</div>
<div class="paragraph">
<p>默认情况下，Spring Boot在默认搜索位置中包括config/*/。这意味着你的jar之外的/config目录的所有子目录都会被搜索到。</p>
</div>
<div class="paragraph">
<p>你可以通过spring.config.location和spring.config.extra-location属性自己使用通配符位置。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>一个通配符位置必须只包含一个*，并且在搜索目录位置时以*/结尾，或者在搜索文件位置时以*/&lt;filename&gt;结尾。带有通配符的位置将根据文件名的绝对路径按字母顺序排序。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>通配符位置只对外部目录起作用。你不能在classpath: 位置中使用通配符。</p>
</div>
</div>
</div>
<div id="特定配置文件" class="paragraph">
<p><strong>特定配置文件</strong>
除了应用程序属性文件外，Spring Boot还将尝试使用命名惯例application-{profile}加载profile特定文件。例如，如果你的应用程序激活了名为prod的配置文件并使用YAML文件，那么application.yml和application-prod.yml都将被考虑。</p>
</div>
<div class="paragraph">
<p>特定于配置文件的属性从与标准application.properties相同的位置加载，特定于配置文件的文件总是凌驾于非特定文件之上。如果指定了几个配置文件，则采用最后胜出的策略。例如，如果profile prod和live是由spring.profiles.active属性指定的，application-prod.properties中的值可以被application-live.properties中的值所覆盖。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>最后胜出的策略适用于位置组级别。spring.config.location的classpath:/cfg/,classpath:/ext/将不会有与classpath:/cfg/;classpath:/ext/相同的覆盖规则。</p>
</div>
<div class="paragraph">
<p>例如，继续我们上面的prod,live例子，我们可能有以下文件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/cfg
  application-live.properties
/ext
  application-live.properties
  application-prod.properties</pre>
</div>
</div>
<div class="paragraph">
<p>当我们的spring.config.location为classpath:/cfg/,classpath:/ext/时，我们会在所有/ext文件之前处理所有/cfg文件。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>/cfg/application-live.properties</code></p>
</li>
<li>
<p><code>/ext/application-prod.properties</code></p>
</li>
<li>
<p><code>/ext/application-live.properties</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>当我们用classpath:/cfg/;classpath:/ext/代替时（有一个;分隔符），我们在同一级别处理/cfg和/ext。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>/ext/application-prod.properties</code></p>
</li>
<li>
<p><code>/cfg/application-live.properties</code></p>
</li>
<li>
<p><code>/ext/application-live.properties</code></p>
</li>
</ol>
</div>
</div>
</div>
<div class="paragraph">
<p>环境有一组默认的配置文件（默认为[default]），如果没有设置活动的配置文件，就会使用这些配置文件。换句话说，如果没有明确激活的配置文件，那么就会考虑来自application-default的属性。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>属性文件只加载一次。如果你已经直接导入了一个配置文件的特定属性文件，那么它将不会被第二次导入。</p>
</div>
</div>
</div>
<div id="导入额外的数据" class="paragraph">
<p><strong>导入额外的数据</strong></p>
</div>
<div class="paragraph">
<p>应用程序属性可以使用spring.config.import属性从其他地方导入进一步的配置数据。导入在被发现时被处理，并被视为附加文件，紧接着插入到声明导入的文件下面。</p>
</div>
<div class="paragraph">
<p>例如，你的classpath application.properties文件中可能有以下内容。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.application.name=myapp
spring.config.import=optional:file:./dev.properties</pre>
</div>
</div>
<div class="paragraph">
<p>这将触发导入当前目录中的 dev.properties 文件（如果存在这样的文件）。导入的 dev.properties 的值将优先于触发导入的文件。在上面的例子中，dev.properties 可以将 spring.application.name 重新定义为一个不同的值。</p>
</div>
<div class="paragraph">
<p>一个导入只能被导入一次，无论它被声明多少次。一个导入在properties/yaml文件中的单个文档中被定义的顺序并不重要。例如，下面的两个例子产生相同的结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.config.import=my.properties
my.property=value</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>my.property=value
spring.config.import=my.properties</pre>
</div>
</div>
<div class="paragraph">
<p>在上述两个例子中，my.properties 文件的值将优先于触发其导入的文件。</p>
</div>
<div class="paragraph">
<p>一个spring.config.import键下可以指定多个位置。位置将按照它们被定义的顺序被处理，后来的导入优先。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在适当的时候，特定于配置文件的变体也被考虑导入。上面的例子将导入 my.properties 以及任何 my-&lt;profile&gt;.properties 变体。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Spring Boot包括可插入的API，允许支持各种不同的位置地址。默认情况下，你可以导入Java属性、YAML和 "配置树"。</p>
</div>
<div class="paragraph">
<p>第三方的jars可以提供对其他技术的支持（不要求文件是本地的）。例如，你可以想象配置数据来自外部存储，如Consul、Apache ZooKeeper或Netflix Archaius。</p>
</div>
<div class="paragraph">
<p>如果你想支持自己的位置，请参阅org.springframework.boot.context.config包中的ConfigDataLocationResolver和ConfigDataLoader类。</p>
</div>
</div>
</div>
<div id="导入无扩展名的文件" class="paragraph">
<p><strong>导入无扩展名的文件</strong></p>
</div>
<div class="paragraph">
<p>有些云平台不能为卷装文件添加文件扩展名。要导入这些无扩展名的文件，你需要给Spring Boot一个提示，以便它知道如何加载它们。你可以通过在方括号里放一个扩展名提示来做到这一点。</p>
</div>
<div class="paragraph">
<p>例如，假设你有一个/etc/config/myconfig文件，你想把它导入为yaml。你可以用下面的方法从你的application.properties中导入它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.config.import=file:/etc/config/myconfig[.yaml]</pre>
</div>
</div>
<div id="使用配置树" class="paragraph">
<p><strong>使用配置树</strong></p>
</div>
<div class="paragraph">
<p>当在云平台（如Kubernetes）上运行应用程序时，你经常需要读取平台提供的配置值。为这种目的使用环境变量并不罕见，但这可能有缺点，特别是如果该值应该是保密的。</p>
</div>
<div class="paragraph">
<p>作为环境变量的替代品，许多云平台现在允许你将配置映射到安装的数据卷中。例如，Kubernetes可以对ConfigMaps和Secrets进行卷装载。</p>
</div>
<div class="paragraph">
<p>有两种常见的卷挂载模式可供使用。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>一个文件包含一套完整的属性（通常写成YAML）。</p>
</li>
<li>
<p>多个文件被写入一个目录树中，文件名成为 "键"，内容成为 "值"。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>对于第一种情况，你可以如上所述使用spring.config.import直接导入YAML或Properties文件。对于第二种情况，你需要使用configtree: 前缀，以便Spring Boot知道它需要将所有文件作为属性公开。</p>
</div>
<div class="paragraph">
<p>作为一个例子，让我们想象一下，Kubernetes已经挂载了以下卷。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>etc/
  config/
    myapp/
      username
      password</pre>
</div>
</div>
<div class="paragraph">
<p>用户名文件的内容将是一个配置值，而密码的内容将是一个秘密。</p>
</div>
<div class="paragraph">
<p>要导入这些属性，你可以在你的application.properties或application.yaml文件中添加以下内容。</p>
</div>
<div class="paragraph">
<p><code>spring.config.import=optional:configtree:/etc/config/</code></p>
</div>
<div class="paragraph">
<p>然后你可以用常用的方式从环境中访问或注入myapp.username和myapp.password属性。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>配置树下的文件夹构成了属性名称。在上面的例子中，为了访问用户名和密码的属性，你可以将spring.config.import设置为optional:configtree:/etc/config/myapp。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>带有点符号的文件名也会被正确映射。例如，在上面的例子中，/etc/config中一个名为myapp.username的文件将导致环境中的myapp.username属性。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>根据预期的内容，配置树的值可以绑定到字符串String和byte[]类型。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>如果你有多个配置树要从同一个父文件夹导入，你可以使用通配符快捷方式。任何以/*//结尾的configtree:位置将导入所有紧邻的子文件夹作为配置树。</p>
</div>
<div class="paragraph">
<p>例如，给定以下卷。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>etc/
  config/
    dbconfig/
      db/
        username
        password
    mqconfig/
      mq/
        username
        password</pre>
</div>
</div>
<div class="paragraph">
<p>你可以这样导入</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.config.import=optional:configtree:/etc/config/*/</pre>
</div>
</div>
<div class="paragraph">
<p>这将添加db.username、db.password、mq.username和mq.password属性。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>使用通配符加载的目录是按字母顺序排列的。如果你需要一个不同的顺序，那么你应该把每个位置作为一个单独的导入列出</p>
</div>
</div>
</div>
<div class="paragraph">
<p>配置树也可以用于Docker secrets。当Docker swarm服务被授予对secrets的访问权时，该secrets会被挂载到容器中。例如，如果一个名为db.password的secrets被挂载在/run/secrets/的位置，你可以通过以下方式让db.password在Spring环境中可用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring.config.import=optional:configtree:/run/secrets/</pre>
</div>
</div>
<div id="属性占位符" class="paragraph">
<p><strong>属性占位符</strong></p>
</div>
<div class="paragraph">
<p>application.properties和application.yml中的值在使用时，会通过现有的Environment进行过滤，所以你可以参考之前定义的值（例如，来自System属性或环境变量）。标准的${name}属性占位符语法可以用在一个值的任何地方。属性占位符也可以指定一个默认值，用": "来分隔默认值和属性名，例如${name:default}。</p>
</div>
<div class="paragraph">
<p>下面的例子显示了带默认值和不带默认值的占位符的使用情况。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>app.name=MyApp
app.description=${app.name} is a Spring Boot application written by ${username:Unknown}</pre>
</div>
</div>
<div class="paragraph">
<p>假如username没有在其他地方定义, app.description 的值将是： MyApp is a Spring Boot application written by Unknown.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你也可以使用这种技术来创建现有Spring Boot属性的 "短 "变体。详情请参见使用 "短 "命令行参数方法。</p>
</div>
</div>
</div>
<div id="处理多文档文件" class="paragraph">
<p><strong>处理多文档文件</strong></p>
</div>
<div class="paragraph">
<p>Spring Boot允许你将一个物理文件分成多个逻辑文件，每个文件都是独立添加的。文件是按顺序处理的，从上到下。后面的文件可以覆盖前面文件中定义的属性。</p>
</div>
<div class="paragraph">
<p>对于application.yml文件，使用标准的YAML多文档语法。三个连续的连字符代表一个文件的结束，和下一个文件的开始。</p>
</div>
<div class="paragraph">
<p>例如，下面的文件有两个逻辑文档。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span style="color:#606">spring</span>:
  <span style="color:#606">application</span>:
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MyApp</span><span style="color:#710">&quot;</span></span>
<span style="color:#f8f;background:#505"><span style="color:#f4f">---</span></span>
<span style="color:#606">spring</span>:
  <span style="color:#606">application</span>:
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MyCloudApp</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">config</span>:
    <span style="color:#606">activate</span>:
      <span style="color:#606">on-cloud-platform</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">kubernetes</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于application.properties文件，一个特殊的#----注释被用来标记文件的分割。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">spring.application.name=MyApp
#---
spring.application.name=MyCloudApp
spring.config.activate.on-cloud-platform=kubernetes</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>属性文件的分隔符不能有任何前导空白，而且必须正好有三个连字符。分隔符的前后两行不能是注释。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>多文档属性文件通常与激活属性（如spring.config.activated.on-profile）一起使用。详见<a href="#激活属性">下一节</a>。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>多文档属性文件不能通过使用@PropertySource或@TestPropertySource注释来加载。</p>
</div>
</div>
</div>
<div id="激活属性" class="paragraph">
<p><strong>激活属性</strong></p>
</div>
<div class="paragraph">
<p>有时，只在满足某些条件时激活一组特定的属性是很有用的。例如，你可能有一些属性只有在特定的配置文件被激活时才相关。</p>
</div>
<div class="paragraph">
<p>你可以使用spring.config.activation.*有条件地激活一个属性文件。</p>
</div>
<div class="paragraph">
<p>以下激活属性是可用的。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Note</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>on-profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一个配置文件表达式，必须与之匹配才能使文件处于活动状态。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>on-cloud-platform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须检测到的云平台，以使文件处于活动状态。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>例如，下面指定第二个文件只有在Kubernetes上运行时才有效，并且只有在 "prod "或 "staging "配置文件激活时才有效。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>myprop=always-set
#---
spring.config.activate.on-cloud-platform=kubernetes
spring.config.activate.on-profile=prod | staging
myotherprop=sometimes-set</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_加密属性"><a class="link" href="#_加密属性">7.2.4. 加密属性</a></h4>
<div class="paragraph">
<p>Spring Boot没有为加密属性值提供任何内置支持，但它确实提供了修改Spring环境中包含的值所需的钩点。EnvironmentPostProcessor接口允许你在应用程序启动前操纵环境。详见在环境启动前自定义环境或应用上下文。</p>
</div>
<div class="paragraph">
<p>如果你需要一种安全的方式来存储凭证和密码，Spring Cloud Vault项目提供了对在HashiCorp Vault中存储外部化配置的支持。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用yaml工作"><a class="link" href="#_使用yaml工作">7.2.5. 使用YAML工作</a></h4>
<div class="paragraph">
<p>YAML是JSON的超集，因此，它是一种用于指定分层配置数据的方便格式。只要你的classpath上有SnakeYAML库，SpringApplication类就会自动支持YAML作为properties的替代品。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你使用 "启动器"，SnakeYAML会自动由spring-boot-starter提供。</p>
</div>
</div>
</div>
<div id="将YAML映射到属性" class="paragraph">
<p><strong>将YAML映射到属性</strong></p>
</div>
<div class="paragraph">
<p>YAML 文档需要从其分层格式转换为可与 Spring 环境一起使用的扁平结构。例如，考虑下面这个YAML文档。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">environments</span>:
  <span style="color:#606">dev</span>:
    <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://dev.example.com</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Developer Setup</span><span style="color:#710">&quot;</span></span>
  <span style="color:#606">prod</span>:
    <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://another.example.com</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">My Cool App</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为了从环境中访问这些属性，它们将被扁平化，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>environments.dev.url=https://dev.example.com
environments.dev.name=Developer Setup
environments.prod.url=https://another.example.com
environments.prod.name=My Cool App</pre>
</div>
</div>
<div class="paragraph">
<p>同样地，YAML列表也需要进行扁平化处理。它们被表示为带有[索引]脱引器的属性键。例如，考虑下面的YAML。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
 servers:
 - "dev.example.com"
 - "another.example.com"</pre>
</div>
</div>
<div class="paragraph">
<p>前面的例子将被转化为这些属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my.servers[0]=dev.example.com
my.servers[1]=another.example.com</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>使用[index]符号的属性可以通过Spring Boot的Binder类绑定到Java List或Set对象。详情请见下面的 <a href="#类型安全的配置属性">类型安全的配置属性</a>部分。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>YAML 文件不能通过使用 @PropertySource 或 @TestPropertySource 注解来加载。所以，在你需要以这种方式加载值的情况下，你需要使用一个属性文件。</p>
</div>
</div>
</div>
<div id="直接加载YAML" class="paragraph">
<p><strong>直接加载YAML</strong></p>
</div>
<div class="paragraph">
<p>Spring Framework提供了两个方便的类，可以用来加载YAML文档。YamlPropertiesFactoryBean将YAML作为属性加载，YamlMapFactoryBean将YAML作为Map加载。</p>
</div>
<div class="paragraph">
<p>如果你想将YAML作为Spring PropertySource加载，你也可以使用YamlPropertySourceLoader类。</p>
</div>
</div>
<div class="sect3">
<h4 id="_配置随机值"><a class="link" href="#_配置随机值">7.2.6. 配置随机值</a></h4>
<div class="paragraph">
<p>RandomValuePropertySource对于注入随机值很有用（例如，注入秘密或测试案例）。它可以产生整数、长数、uuids或字符串，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my.secret=${random.value}
my.number=${random.int}
my.bignumber=${random.long}
my.uuid=${random.uuid}
my.number-less-than-ten=${random.int(10)}
my.number-in-range=${random.int[1024,65536]}</pre>
</div>
</div>
<div class="paragraph">
<p>The random.int* syntax is OPEN value (,max) CLOSE where the OPEN,CLOSE are any character and value,max are integers. If max is provided, then value is the minimum value and max is the maximum value (exclusive).</p>
</div>
<div class="paragraph">
<p>random.int*的语法是OPEN value (,max) CLOSE，其中OPEN,CLOSE是任何字符，value,max是整数。如果提供了max，那么value是最小值，max是最大值（独占）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_配置系统环境属性"><a class="link" href="#_配置系统环境属性">7.2.7. 配置系统环境属性</a></h4>
<div class="paragraph">
<p>Spring Boot支持为环境属性设置一个前缀。如果系统环境被多个具有不同配置要求的Spring Boot应用程序共享，这就很有用。系统环境属性的前缀可以直接在SpringApplication上设置。</p>
</div>
<div class="paragraph">
<p>例如，如果你把前缀设置为input，那么像remote.timeout这样的属性在系统环境中也将被解析为input.remote.timeout。</p>
</div>
</div>
<div class="sect3">
<h4 id="类型安全的配置属性"><a class="link" href="#类型安全的配置属性">7.2.8. 类型安全的配置属性</a></h4>
<div class="paragraph">
<p>使用@Value("${property}")注解来注入配置属性有时会很麻烦，特别是当你要处理多个属性或你的数据是分层的。Spring Boot提供了一种处理属性的替代方法，让强类型的Bean管理和验证你的应用程序的配置。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>另请参见&lt;&lt;@Value和类型安全配置属性之间的区别&gt;&gt;。</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="JavaBean属性绑定"><a class="link" href="#JavaBean属性绑定">7.2.8.1. JavaBean属性绑定</a></h5>
<div class="paragraph">
<p>如下面的例子所示，可以绑定一个声明了标准JavaBean属性的bean。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.net.InetAddress</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.ArrayList</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.Collections</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.List</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.service</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#339;font-weight:bold">boolean</span> enabled;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Security</span> security = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Security</span>();

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">boolean</span> isEnabled() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.enabled;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setEnabled(<span style="color:#339;font-weight:bold">boolean</span> enabled) {
        <span style="color:#950">this</span>.enabled = enabled;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> getRemoteAddress() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setRemoteAddress(<span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress) {
        <span style="color:#950">this</span>.remoteAddress = remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Security</span> getSecurity() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.security;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Security</span> {

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> username;

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> password;

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; roles = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;&gt;(<span style="color:#0a8;font-weight:bold">Collections</span>.singleton(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">USER</span><span style="color:#710">&quot;</span></span>));

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getUsername() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.username;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setUsername(<span style="color:#0a8;font-weight:bold">String</span> username) {
            <span style="color:#950">this</span>.username = username;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getPassword() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.password;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setPassword(<span style="color:#0a8;font-weight:bold">String</span> password) {
            <span style="color:#950">this</span>.password = password;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; getRoles() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.roles;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setRoles(<span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; roles) {
            <span style="color:#950">this</span>.roles = roles;
        }

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>前面的POJO定义了以下属性。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>my.service.enabled，默认值为false。</p>
</li>
<li>
<p>my.service.remote-address，其类型可由String强制转换。</p>
</li>
<li>
<p>my.service.security.username，有一个嵌套的 "security "对象，其名称由该属性的名称决定。特别是，那里根本就没有使用类型，可以是SecurityProperties。</p>
</li>
<li>
<p>my.service.security.password.</p>
</li>
<li>
<p>my.service.security.roles, with a collection of String that defaults to USER.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>映射到Spring Boot中可用的@ConfigurationProperties类的属性，通过属性文件、YAML文件、环境变量和其他机制进行配置，这些属性是公共API，但类本身的访问器（getters/setters）并不意味着可以直接使用。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>这样的安排依赖于一个默认的空构造函数，而getter和setter通常是强制性的，因为绑定是通过标准的Java Beans属性描述符，就像Spring MVC中一样。在以下情况下，可以省略setter。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map，只要它们被初始化，就需要一个getter，但不一定需要一个setter，因为它们可以被绑定器变异。</p>
</li>
<li>
<p>集合和数组可以通过索引（通常用YAML）或使用单个逗号分隔的值（属性）来访问。在后一种情况下，一个setter是必须的。我们建议总是为这类类型添加一个setter。如果你初始化一个集合，确保它不是不可变的（如前面的例子）。</p>
</li>
<li>
<p>如果嵌套的POJO属性被初始化（就像前面例子中的Security字段），就不需要设置器。如果你想让绑定器通过使用它的默认构造函数来即时创建实例，你需要一个setter。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有些人使用Project Lombok来自动添加getters和setters。请确保Lombok不会为这样的类型生成任何特定的构造函数，因为它被容器自动用来实例化对象。</p>
</div>
<div class="paragraph">
<p>最后，只考虑标准的Java Bean属性，不支持对静态属性的绑定。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="构造函数绑定"><a class="link" href="#构造函数绑定">7.2.8.2. 构造函数绑定</a></h5>
<div class="paragraph">
<p>上一节的例子可以用不可变的方式重写，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.net.InetAddress</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.List</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConstructorBinding</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.bind.DefaultValue</span>;

<span style="color:#007">@ConstructorBinding</span>
<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.service</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#339;font-weight:bold">boolean</span> enabled;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Security</span> security;

    <span style="color:#088;font-weight:bold">public</span> MyProperties(<span style="color:#339;font-weight:bold">boolean</span> enabled, <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress, <span style="color:#0a8;font-weight:bold">Security</span> security) {
        <span style="color:#950">this</span>.enabled = enabled;
        <span style="color:#950">this</span>.remoteAddress = remoteAddress;
        <span style="color:#950">this</span>.security = security;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">boolean</span> isEnabled() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.enabled;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> getRemoteAddress() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Security</span> getSecurity() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.security;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Security</span> {

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> username;

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">String</span> password;

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; roles;

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Security</span>(<span style="color:#0a8;font-weight:bold">String</span> username, <span style="color:#0a8;font-weight:bold">String</span> password, <span style="color:#007">@DefaultValue</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">USER</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; roles) {
            <span style="color:#950">this</span>.username = username;
            <span style="color:#950">this</span>.password = password;
            <span style="color:#950">this</span>.roles = roles;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getUsername() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.username;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getPassword() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.password;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>&gt; getRoles() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.roles;
        }

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个设置中，@ConstructorBinding注解被用来表示应该使用构造函数绑定。这意味着绑定器将期望找到一个具有你希望绑定的参数的构造器。如果你使用的是Java 16或更高版本，构造函数绑定可以与记录一起使用。在这种情况下，除非你的记录有多个构造函数，否则没有必要使用@ConstructorBinding。</p>
</div>
<div class="paragraph">
<p>@ConstructorBinding类的嵌套成员（如上面例子中的Security）也将通过其构造函数被绑定。</p>
</div>
<div class="paragraph">
<p>默认值可以在构造函数参数上使用@DefaultValue来指定，或者在使用Java 16或更高版本时，使用记录组件。转换服务将被应用于将字符串值强制转换为缺失属性的目标类型。</p>
</div>
<div class="paragraph">
<p>参照前面的例子，如果没有属性绑定到Security，MyProperties实例将包含一个空的Security值。如果你想返回一个非空的Security实例，即使没有属性与之绑定，你可以使用一个空的@DefaultValue注解来实现。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#088;font-weight:bold">public</span> MyProperties(<span style="color:#339;font-weight:bold">boolean</span> enabled, <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress, <span style="color:#007">@DefaultValue</span> <span style="color:#0a8;font-weight:bold">Security</span> security) {
    <span style="color:#950">this</span>.enabled = enabled;
    <span style="color:#950">this</span>.remoteAddress = remoteAddress;
    <span style="color:#950">this</span>.security = security;
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>要使用构造函数绑定，该类必须使用@EnableConfigurationProperties或配置属性扫描启用。你不能对通过常规Spring机制创建的Bean使用构造函数绑定（例如@Component Bean、通过使用@Bean方法创建的Bean或通过使用@Import加载的Bean）。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你的类有一个以上的构造函数，你也可以直接在应该被绑定的构造函数上使用@ConstructorBinding。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>不建议使用java.util.Optional和@ConfigurationProperties，因为它主要是作为一种返回类型使用。因此，它并不适合于配置属性注入。为了与其他类型的属性保持一致，如果你确实声明了一个Optional属性，但它没有值，那么将绑定null而不是一个空的Optional。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="启用ConfigurationProperties-annotated注解"><a class="link" href="#启用ConfigurationProperties-annotated注解">7.2.8.3. 启用@ConfigurationProperties注解</a></h5>
<div class="paragraph">
<p>Spring Boot提供了绑定@ConfigurationProperties类型并将其注册为bean的基础设施。你可以在逐个类的基础上启用配置属性，或者启用配置属性扫描，其工作方式与组件扫描类似。</p>
</div>
<div class="paragraph">
<p>有时，用@ConfigurationProperties注解的类可能不适合扫描，例如，如果你正在开发你自己的自动配置或者你想有条件地启用它们。在这些情况下，使用@EnableConfigurationProperties注解指定要处理的类型列表。这可以在任何@Configuration类上进行，如下面的例子中所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import org.springframework.boot.context.properties.EnableConfigurationProperties;
import org.springframework.context.annotation.Configuration;

@Configuration(proxyBeanMethods = false)
@EnableConfigurationProperties(SomeProperties.class)
public class MyConfiguration {

}</pre>
</div>
</div>
<div class="paragraph">
<p>要使用配置属性扫描，请将@ConfigurationPropertiesScan注解添加到你的应用程序。通常情况下，它被添加到用@SpringBootApplication注解的主应用程序类中，但它也可以被添加到任何@Configuration类。默认情况下，扫描将从声明该注解的类的包中发生。如果你想定义特定的包来扫描，你可以这样做，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.context.properties.ConfigurationPropertiesScan;

@SpringBootApplication
@ConfigurationPropertiesScan({ "com.example.app", "com.example.another" })
public class MyApplication {

}</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>当@ConfigurationProperties Bean使用配置属性扫描或通过@EnableConfigurationProperties注册时，该bean有一个常规的名字。&lt;prefix&gt;-&lt;fqn&gt;，其中&lt;prefix&gt;是在 @ConfigurationProperties 注解中指定的环境键前缀，&lt;fqn&gt;是 bean 的完全限定名称。如果注解没有提供任何前缀，则只使用Bean的完全合格名称。</p>
</div>
<div class="paragraph">
<p>上面的例子中的Bean名称是com.example.app-com.example.app.SomeProperties。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>我们建议@ConfigurationProperties只处理环境，特别是不从上下文中注入其他bean。对于角落里的情况，可以使用设置器注入或框架提供的任何*Aware接口（如EnvironmentAware，如果你需要访问环境）。如果你仍然想使用构造器注入其他Bean，配置属性Bean必须用@Component来注释，并使用基于JavaBean的属性绑定。</p>
</div>
</div>
<div class="sect4">
<h5 id="使用ConfigurationProperties-annotated注解"><a class="link" href="#使用ConfigurationProperties-annotated注解">7.2.8.4. 使用@ConfigurationProperties注解</a></h5>
<div class="paragraph">
<p>这种配置风格与SpringApplication的外部YAML配置配合得特别好，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
  service:
    remote-address: 192.168.1.1
    security:
      username: "admin"
      roles:
      - "USER"
      - "ADMIN"</pre>
</div>
</div>
<div class="paragraph">
<p>要使用@ConfigurationProperties Bean，你可以用与其他Bean相同的方式注入它们，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.stereotype.Service</span>;

<span style="color:#007">@Service</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyService</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> SomeProperties properties;

    <span style="color:#088;font-weight:bold">public</span> MyService(SomeProperties properties) {
        <span style="color:#950">this</span>.properties = properties;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> openConnection() {
        Server server = <span style="color:#080;font-weight:bold">new</span> Server(<span style="color:#950">this</span>.properties.getRemoteAddress());
        server.start();
        <span style="color:#777">// ...</span>
    }

    <span style="color:#777">// ...</span>

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>使用@ConfigurationProperties还可以让你生成元数据文件，这些文件可以被IDE用来为你自己的键提供自动完成。详见附录。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="第三方配置"><a class="link" href="#第三方配置">7.2.8.5. 第三方配置</a></h5>
<div class="paragraph">
<p>除了使用@ConfigurationProperties来注释一个类之外，你还可以在公共的@Bean方法上使用它。当你想把属性绑定到你控制之外的第三方组件时，这样做特别有用。</p>
</div>
<div class="paragraph">
<p>要从环境属性中配置一个Bean，请将@ConfigurationProperties添加到其Bean注册中，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.annotation.Bean</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.context.annotation.Configuration</span>;

<span style="color:#007">@Configuration</span>(proxyBeanMethods = <span style="color:#069">false</span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ThirdPartyConfiguration</span> {

    <span style="color:#007">@Bean</span>
    <span style="color:#007">@ConfigurationProperties</span>(prefix = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">another</span><span style="color:#710">&quot;</span></span>)
    <span style="color:#088;font-weight:bold">public</span> AnotherComponent anotherComponent() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#080;font-weight:bold">new</span> AnotherComponent();
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="RelaxedBinding"><a class="link" href="#RelaxedBinding">7.2.8.6. Relaxed Binding</a></h5>
<div class="paragraph">
<p>Spring Boot 在将环境属性绑定到 @ConfigurationProperties Bean 时使用了一些宽松的规则，因此环境属性名称和 Bean 属性名称之间不需要完全匹配。这很有用，常见的例子包括破折号分隔的环境属性（例如，context-path绑定到contextPath），以及大写的环境属性（例如，PORT绑定到port）。</p>
</div>
<div class="paragraph">
<p>作为一个例子，考虑下面的 @ConfigurationProperties 类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;

<span style="color:#007">@ConfigurationProperties</span>(prefix = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.main-project.person</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyPersonProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> firstName;

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getFirstName() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.firstName;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setFirstName(<span style="color:#0a8;font-weight:bold">String</span> firstName) {
        <span style="color:#950">this</span>.firstName = firstName;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以下的配置都可注入到上面的代码中</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>my.main-project.person.first-name</code></p>
</li>
<li>
<p><code>my.main-project.person.firstName</code></p>
</li>
<li>
<p><code>my.main-project.person.first_name</code></p>
</li>
<li>
<p><code>MY_MAINPROJECT_PERSON_FIRSTNAME</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>@ConfigurationProperties(prefix = "")  中的"prefix"只能是小写，可以用-分隔单词</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>We recommend that, when possible, properties are stored in lower-case kebab format, such as my.person.first-name=Rod.</p>
</div>
<div class="paragraph">
<p>我们建议，尽量使用kebab-case格式的命名 比如 my.person.first-name=Rod.</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>绑定map</strong></p>
</div>
<div class="paragraph">
<p>当绑定到Map属性时，你可能需要使用一个特殊的括号符号，以便保留原始的键值。如果键没有被[]包围，任何非字母数字、-或.的字符都会被删除。</p>
</div>
<div class="paragraph">
<p>例如，考虑将以下属性绑定到一个Map&lt;String,String&gt;。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my.map.[/key1]=value1
my.map.[/key2]=value2
my.map./key3=value3</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
  map:
    "[/key1]": "value1"
    "[/key2]": "value2"
    "/key3": "value3"</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>对于YAML文件，括号需要用引号包围，以使键被正确解析。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>上面的属性将绑定到一个Map，/key1、/key2和key3是map中的键。斜线已经从key3中移除，因为它没有被方括号包围。</p>
</div>
<div class="paragraph">
<p>当绑定到标量值时，带有.的键不需要用[]包围。标量值包括枚举和java.lang包中除了Object以外的所有类型。将a.b=c绑定到Map&lt;String, String&gt;将保留键中的.并返回一个带有{"a.b"="c"}条目的Map。对于任何其他类型，如果你的键包含.，你需要使用括号符号。例如，将a.b=c绑定到Map&lt;String, Object&gt;将返回一个带有{"a"={"b"="c"}条目的Map，而[a.b]=c将返回一个带有{"a.b"="c"}条目的Map。｝</p>
</div>
<div class="paragraph">
<p><strong>从环境变量绑定</strong></p>
</div>
<div class="paragraph">
<p>大多数操作系统对可用于环境变量的名称有严格的规定。例如，Linux shell变量只能包含字母（a到z或A到Z）、数字（0到9）或下划线字符（_）。按照惯例，Unix shell变量的名称也将采用大写字母。</p>
</div>
<div class="paragraph">
<p>Spring Boot的宽松绑定规则尽可能地与这些命名限制兼容。</p>
</div>
<div class="paragraph">
<p>要将规范形式的属性名称转换为环境变量名称，你可以遵循这些规则。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>把  .  替换为 _</p>
</li>
<li>
<p>移除所有 -</p>
</li>
<li>
<p>转换成大写</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，配置属性 spring.main.log-startup-info 将是一个名为 SPRING_MAIN_LOGSTARTUPINFO 的环境变量。</p>
</div>
<div class="paragraph">
<p>环境变量也可以在绑定到对象列表时使用。要绑定到一个列表，在变量名称中，元素编号应该用下划线包围。</p>
</div>
<div class="paragraph">
<p>例如，配置属性 my.service[0].other 将使用一个名为 MY_SERVICE_0_OTHER 的环境变量。</p>
</div>
</div>
<div class="sect4">
<h5 id="_合并复杂类型"><a class="link" href="#_合并复杂类型">7.2.8.7. 合并复杂类型</a></h5>
<div class="paragraph">
<p>当列表被配置在一个以上的地方时，覆盖的作用是替换整个列表。</p>
</div>
<div class="paragraph">
<p>例如，假设一个MyPojo对象的名称和描述属性默认为空。下面的例子从MyProperties暴露了一个MyPojo对象的列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.ArrayList</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.List</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyPojo&gt; list = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">ArrayList</span>&lt;&gt;();

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">List</span>&lt;MyPojo&gt; getList() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.list;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后有以下配置</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
  list:
  - name: "my name"
    description: "my description"
---
spring:
  config:
    activate:
      on-profile: "dev"
my:
  list:
  - name: "my another name"</pre>
</div>
</div>
<div class="paragraph">
<p>如果dev profile没有被激活，MyProperties.list包含一个MyPojo条目，正如之前定义的那样。然而，如果dev profile被激活，列表中仍然只包含一个条目（名字是  my another name ，描述是null）。这种配置不会在列表中添加第二个MyPojo实例，也不会合并这些项目。</p>
</div>
<div class="paragraph">
<p>当一个列表在多个配置文件中被指定时，具有最高优先级的那个（而且只有那个）被使用。考虑下面的例子。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
  list:
  - name: "my name"
    description: "my description"
  - name: "another name"
    description: "another description"
---
spring:
  config:
    activate:
      on-profile: "dev"
my:
  list:
  - name: "my another name"</pre>
</div>
</div>
<div class="paragraph">
<p>在前面的例子中，如果dev profile处于激活状态，MyProperties.list包含一个MyPojo条目（名字为  my another name ，描述为null）。对于YAML，逗号分隔的列表和YAML列表都可以用来完全覆盖列表的内容。</p>
</div>
<div class="paragraph">
<p>对于Map属性，你可以用从多个来源提取的属性值进行绑定。然而，对于多个源中的同一属性，使用具有最高优先级的那个。下面的例子从MyProperties暴露了一个Map&lt;String, MyPojo&gt;。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.LinkedHashMap</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.util.Map</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, MyPojo&gt; map = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">LinkedHashMap</span>&lt;&gt;();

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Map</span>&lt;<span style="color:#0a8;font-weight:bold">String</span>, MyPojo&gt; getMap() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.map;
    }

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>my:
  map:
    key1:
      name: "my name 1"
      description: "my description 1"
---
spring:
  config:
    activate:
      on-profile: "dev"
my:
  map:
    key1:
      name: "dev name 1"
    key2:
      name: "dev name 2"
      description: "dev description 2"</pre>
</div>
</div>
<div class="paragraph">
<p>如果dev profile没有激活，MyProperties.map包含一个key key1的条目（名字是my name 1，描述是my description 1）。然而，如果dev profile被激活，map包含两个条目，分别是key1（名字为dev name 1，描述为my description 1）和key2（名字为dev name 2，描述为dev description 2）。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>前面的合并规则适用于所有属性源的属性，而不仅仅是文件。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_属性转换"><a class="link" href="#_属性转换">7.2.8.8. 属性转换</a></h5>
<div class="paragraph">
<p>Spring Boot在与@ConfigurationProperties Bean绑定时，会尝试将外部应用程序属性强制转换为正确的类型。如果你需要自定义类型转换，你可以提供一个ConversionService Bean（有一个名为conversionService的Bean）或自定义属性编辑器（通过CustomEditorConfigurer Bean）或自定义转换器（有注释为@ConfigurationPropertiesBinding的Bean定义）。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>由于这个Bean是在应用程序生命周期的早期被请求的，所以要确保限制你的ConversionService所使用的依赖关系。通常情况下，你所需要的任何依赖关系在创建时可能不会被完全初始化。如果配置键强制不需要你的自定义ConversionService，你可能想重命名它，并且只依赖用@ConfigurationPropertiesBinding限定的自定义转换器。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>转换期限</strong></p>
</div>
<div class="paragraph">
<p>Spring Boot对表达持续时间有专门的支持。如果你公开了java.time.Duration属性，应用程序属性中就有以下格式。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个普通的长表示法（使用毫秒作为默认单位，除非已经指定了@DurationUnit）。</p>
</li>
<li>
<p>java.time.Duration使用的标准ISO-8601格式。</p>
</li>
<li>
<p>一个更易读的格式，其中数值和单位是耦合的（10s表示10秒）。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.time.Duration</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.time.temporal.ChronoUnit</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.convert.DurationUnit</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#007">@DurationUnit</span>(ChronoUnit.SECONDS)
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Duration</span> sessionTimeout = <span style="color:#0a8;font-weight:bold">Duration</span>.ofSeconds(<span style="color:#00D">30</span>);

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">Duration</span> readTimeout = <span style="color:#0a8;font-weight:bold">Duration</span>.ofMillis(<span style="color:#00D">1000</span>);

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Duration</span> getSessionTimeout() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.sessionTimeout;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setSessionTimeout(<span style="color:#0a8;font-weight:bold">Duration</span> sessionTimeout) {
        <span style="color:#950">this</span>.sessionTimeout = sessionTimeout;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Duration</span> getReadTimeout() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.readTimeout;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setReadTimeout(<span style="color:#0a8;font-weight:bold">Duration</span> readTimeout) {
        <span style="color:#950">this</span>.readTimeout = readTimeout;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要指定一个30秒的会话超时，30、PT30S和30s都是等价的。可以用以下任何一种形式指定500ms的读取超时。500、PT0.5S和500ms。</p>
</div>
<div class="paragraph">
<p>你也可以使用任何支持的单位。这些单位是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ns:纳秒</p>
</li>
<li>
<p>us:微秒</p>
</li>
<li>
<p>ms:毫秒</p>
</li>
<li>
<p>s:秒</p>
</li>
<li>
<p>m:分钟</p>
</li>
<li>
<p>h:小时</p>
</li>
<li>
<p>d:天</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认单位是毫秒，可以使用@DurationUnit来重写，如上面的例子所示。</p>
</div>
<div class="paragraph">
<p>如果你喜欢使用构造函数绑定，同样的属性可以被暴露出来，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.time.Duration</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.time.temporal.ChronoUnit</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConstructorBinding</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.bind.DefaultValue</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.convert.DurationUnit</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@ConstructorBinding</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Duration</span> sessionTimeout;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Duration</span> readTimeout;

    <span style="color:#088;font-weight:bold">public</span> MyProperties(<span style="color:#007">@DurationUnit</span>(ChronoUnit.SECONDS) <span style="color:#007">@DefaultValue</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">30s</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">Duration</span> sessionTimeout,
            <span style="color:#007">@DefaultValue</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">1000ms</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a8;font-weight:bold">Duration</span> readTimeout) {
        <span style="color:#950">this</span>.sessionTimeout = sessionTimeout;
        <span style="color:#950">this</span>.readTimeout = readTimeout;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Duration</span> getSessionTimeout() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.sessionTimeout;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Duration</span> getReadTimeout() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.readTimeout;
    }

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你正在升级一个Long属性，请确保定义单位（使用@DurationUnit），如果它不是毫秒。这样做提供了一个透明的升级路径，同时支持更丰富的格式。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>转换 期限</strong></p>
</div>
<div class="paragraph">
<p>除了期限之外，Spring Boot还可以使用java.time.Period类型。以下格式可以在应用程序属性中使用。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个普通的int表示法（使用天作为默认单位，除非已经指定了@PeriodUnit）。</p>
</li>
<li>
<p>java.time.Period使用的标准ISO-8601格式。</p>
</li>
<li>
<p>一个更简单的格式，数值和单位对是耦合的（1y3d表示1年3天）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>可以使用以下单位</p>
</div>
<div class="ulist">
<ul>
<li>
<p>y 年</p>
</li>
<li>
<p>m 月</p>
</li>
<li>
<p>w 星期</p>
</li>
<li>
<p>d 天</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>java.time.Period类型从未实际存储过周数，它是一个快捷方式，意味着 "7天"。</p>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>转换 Data Sizes</strong></p>
</div>
<div class="paragraph">
<p>Spring Framework有一个DataSize值类型，表示以字节为单位的大小。如果你公开了一个DataSize属性，那么在应用程序属性中可以使用以下格式。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一个普通的long表示法（使用字节作为默认单位，除非已经指定了@DataSizeUnit）。</p>
</li>
<li>
<p>一个更易读的格式，其中数值和单位是耦合的（10MB表示10兆字节）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>举个例子</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.convert.DataSizeUnit</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.util.unit.DataSize</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.util.unit.DataUnit</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#007">@DataSizeUnit</span>(DataUnit.MEGABYTES)
    <span style="color:#088;font-weight:bold">private</span> DataSize bufferSize = DataSize.ofMegabytes(<span style="color:#00D">2</span>);

    <span style="color:#088;font-weight:bold">private</span> DataSize sizeThreshold = DataSize.ofBytes(<span style="color:#00D">512</span>);

    <span style="color:#088;font-weight:bold">public</span> DataSize getBufferSize() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.bufferSize;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setBufferSize(DataSize bufferSize) {
        <span style="color:#950">this</span>.bufferSize = bufferSize;
    }

    <span style="color:#088;font-weight:bold">public</span> DataSize getSizeThreshold() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.sizeThreshold;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setSizeThreshold(DataSize sizeThreshold) {
        <span style="color:#950">this</span>.sizeThreshold = sizeThreshold;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要指定一个10兆字节的缓冲区大小，10和10MB是等价的。256字节的大小阈值可以指定为256或256B。</p>
</div>
<div class="paragraph">
<p>你也可以使用任何支持的单位。这些单位是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>B</p>
</li>
<li>
<p>KB</p>
</li>
<li>
<p>MB</p>
</li>
<li>
<p>GB</p>
</li>
<li>
<p>TB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认单位是字节，可以使用@DataSizeUnit来重写，如上面的例子所示。</p>
</div>
<div class="paragraph">
<p>如果你喜欢使用构造函数绑定，同样的属性可以被暴露出来，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConstructorBinding</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.bind.DefaultValue</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.convert.DataSizeUnit</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.util.unit.DataSize</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.util.unit.DataUnit</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@ConstructorBinding</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> DataSize bufferSize;

    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> DataSize sizeThreshold;

    <span style="color:#088;font-weight:bold">public</span> MyProperties(<span style="color:#007">@DataSizeUnit</span>(DataUnit.MEGABYTES) <span style="color:#007">@DefaultValue</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">2MB</span><span style="color:#710">&quot;</span></span>) DataSize bufferSize,
            <span style="color:#007">@DefaultValue</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">512B</span><span style="color:#710">&quot;</span></span>) DataSize sizeThreshold) {
        <span style="color:#950">this</span>.bufferSize = bufferSize;
        <span style="color:#950">this</span>.sizeThreshold = sizeThreshold;
    }

    <span style="color:#088;font-weight:bold">public</span> DataSize getBufferSize() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.bufferSize;
    }

    <span style="color:#088;font-weight:bold">public</span> DataSize getSizeThreshold() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.sizeThreshold;
    }

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你正在升级一个Long属性，如果它不是字节，请确保定义单位（使用@DataSizeUnit）。这样做提供了一个透明的升级路径，同时支持更丰富的格式。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configurationproperties_验证"><a class="link" href="#_configurationproperties_验证">7.2.8.9. @ConfigurationProperties 验证</a></h5>
<div class="paragraph">
<p>只要@ConfigurationProperties类被Spring的@Validated注解所注解，Spring Boot就会尝试验证它们。你可以直接在你的配置类上使用JSR-303 javax.validation约束注解。要做到这一点，请确保你的classpath上有一个兼容的JSR-303实现，然后将约束注解添加到你的字段中，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.net.InetAddress</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.validation.constraints.NotNull</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.validation.annotation.Validated</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.service</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@Validated</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#007">@NotNull</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress;

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> getRemoteAddress() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setRemoteAddress(<span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress) {
        <span style="color:#950">this</span>.remoteAddress = remoteAddress;
    }

}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你也可以通过用@Validated注解创建配置属性的@Bean方法来触发验证。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>为了确保总是为嵌套的属性触发验证，即使没有找到属性，相关的字段必须用@Valid来注释。下面的例子是建立在前面的MyProperties例子之上的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">java.net.InetAddress</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.validation.Valid</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.validation.constraints.NotEmpty</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.validation.constraints.NotNull</span>;

<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.boot.context.properties.ConfigurationProperties</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">org.springframework.validation.annotation.Validated</span>;

<span style="color:#007">@ConfigurationProperties</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">my.service</span><span style="color:#710">&quot;</span></span>)
<span style="color:#007">@Validated</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MyProperties</span> {

    <span style="color:#007">@NotNull</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress;

    <span style="color:#007">@Valid</span>
    <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a8;font-weight:bold">Security</span> security = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a8;font-weight:bold">Security</span>();

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">InetAddress</span> getRemoteAddress() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setRemoteAddress(<span style="color:#0a8;font-weight:bold">InetAddress</span> remoteAddress) {
        <span style="color:#950">this</span>.remoteAddress = remoteAddress;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">Security</span> getSecurity() {
        <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.security;
    }

    <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">Security</span> {

        <span style="color:#007">@NotEmpty</span>
        <span style="color:#088;font-weight:bold">private</span> <span style="color:#0a8;font-weight:bold">String</span> username;

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a8;font-weight:bold">String</span> getUsername() {
            <span style="color:#080;font-weight:bold">return</span> <span style="color:#950">this</span>.username;
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> setUsername(<span style="color:#0a8;font-weight:bold">String</span> username) {
            <span style="color:#950">this</span>.username = username;
        }

    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以通过创建一个名为configurationPropertiesValidator的bean定义来添加一个自定义的Spring验证器。这个@Bean方法应该被声明为静态的。配置属性验证器是在应用程序生命周期的早期创建的，将@Bean方法声明为静态，可以让Bean的创建无需实例化@Configuration类。这样做可以避免早期实例化可能引起的任何问题。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>spring-boot-actuator模块包括一个暴露所有@ConfigurationProperties Bean的端点。将你的网络浏览器指向/actuator/configprops或使用相应的JMX端点。详情见 <a href="#生产就绪的特性">[生产就绪的特性]</a>部分。</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_value和类型安全配置属性之间的区别"><a class="link" href="#_value和类型安全配置属性之间的区别">7.2.8.10. @Value和类型安全配置属性之间的区别</a></h5>
<div class="paragraph">
<p>@Value注解是一个核心的容器特性，它不提供与类型安全的配置属性相同的特性。下表总结了@ConfigurationProperties和@Value所支持的功能。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">特征</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@ConfigurationProperties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">@Values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#RelaxedBinding">Relaxed Binding</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部分支持<a href="#_profiles">Profiles</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">元数据支持</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SpEL评价</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你确实想使用@Value，我们建议你使用属性名称的典型形式（只使用小写字母的kebab-case）。这将允许Spring Boot使用与放松绑定@ConfigurationProperties时一样的逻辑。例如，@Value("{demo.item-price}")将从application.properties文件中获取demo.item-price和demo.itemPrice形式，以及从系统环境中获取DEMO_ITEMPRICE。如果你用@Value("{demo.itemPrice}")代替，Demo.item-price和DEMO_ITEMPRICE就不会被考虑。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>如果你为你自己的组件定义了一组配置键，我们建议你将它们分组在一个用@ConfigurationProperties注释的POJO中。这样做将为你提供结构化的、类型安全的对象，你可以将其注入到你自己的bean中。</p>
</div>
<div class="paragraph">
<p>来自应用程序属性文件的SpEL表达式在解析这些文件和填充环境时不会被处理。然而，可以在@Value中写一个SpEL表达式。如果来自应用程序属性文件的属性值是一个SpEL表达式，它将在通过@Value消费时被评估。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_profiles"><a class="link" href="#_profiles">7.3. Profiles</a></h3>
<div class="paragraph">
<p>Spring Profiles提供了一种方法来隔离你的应用程序配置的一部分，并使其仅在某些环境中可用。任何@Component、@Configuration或@ConfigurationProperties都可以用@Profile来标记，以限制它被加载的时间，如下例所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Profile;

@Configuration(proxyBeanMethods = false)
@Profile("production")
public class ProductionConfiguration {

    // ...

}</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果@ConfigurationProperties bean是通过@EnableConfigurationProperties而不是自动扫描注册的，则需要在具有@EnableConfigurationProperties注释的@Configuration类上指定@Profile注释。在扫描@ConfigurationProperties的情况下，@Profile可以在@ConfigurationProperties类本身上指定。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>你可以使用 spring.profiles.active 环境属性来指定哪些配置文件是活动的。你可以通过本章前面描述的任何方式来指定该属性。例如，你可以在你的application.properties中包含它，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span style="color:#606">spring</span>:
  <span style="color:#606">profiles</span>:
    <span style="color:#606">active</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">dev,hsqldb</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>你也可以在命令行中使用以下开关指定它： --spring.profiles.active=dev,hsqldb。</p>
</div>
<div class="paragraph">
<p>如果没有激活配置文件，就会启用一个默认的配置文件。默认配置文件的名称是default，可以使用spring.profiles.default环境属性对其进行调整，如下面的例子所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  profiles:
    default: "none"</pre>
</div>
</div>
<div class="paragraph">
<p>spring.profiles.active 和 spring.profiles.default 只能用于非配置文件的文件。这意味着它们不能包含在配置文件特定的文件或由spring.config.activate.on-profile激活的文件中。</p>
</div>
<div class="paragraph">
<p>例如，第二个文件配置是无效的。</p>
</div>
<div class="listingblock">
<div class="content">
<pre># this document is valid
spring:
  profiles:
    active: "prod"
---
# this document is invalid
spring:
  config:
    activate:
      on-profile: "prod"
  profiles:
    active: "metrics"</pre>
</div>
</div>
<div class="sect3">
<h4 id="_adding_active_profile"><a class="link" href="#_adding_active_profile">7.3.1. Adding Active Profile</a></h4>
<div class="paragraph">
<p>spring.profiles.active属性遵循与其他属性相同的排序规则。最高的PropertySource获胜。这意味着你可以在application.properties中指定活动配置文件，然后通过使用命令行开关来替换它们。</p>
</div>
<div class="paragraph">
<p>有时，拥有增加到活动配置文件而不是替换它们的属性是很有用的。spring.profiles.include 属性可用于在 spring.profiles.active 属性激活的配置文件之上添加活动配置文件。SpringApplication入口点也有一个Java API用于设置额外的配置文件。参见SpringApplication中的setAdditionalProfiles()方法。</p>
</div>
<div class="paragraph">
<p>例如，当一个具有以下属性的应用程序被运行时，即使它使用&#8212;&#8203;spring.profiles.active开关运行，common和local配置文件也会被激活。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  profiles:
    include:
      - "common"
      - "local"</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>与spring.profiles.active类似，spring.profiles.include只能用于非配置文件的文件。这意味着它不能被包含在配置文件特定的文件或由spring.config.activated.on-profile激活的文件中。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>如果一个给定的配置文件是活动的，配置文件组，在下一节中描述，也可以用来添加活动的配置文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_profile_groups"><a class="link" href="#_profile_groups">7.3.2. Profile Groups</a></h4>
<div class="paragraph">
<p>偶尔，你在你的应用程序中定义和使用的配置文件过于细化，使用起来也很麻烦。例如，你可能有proddb和prodmq配置文件，用于独立启用数据库和消息传递功能。</p>
</div>
<div class="paragraph">
<p>为了帮助解决这个问题，Spring Boot允许你定义配置文件组。配置文件组允许你为相关的配置文件组定义一个逻辑名称。</p>
</div>
<div class="paragraph">
<p>例如，我们可以创建一个生产组，由我们的proddb和prodmq配置文件组成。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spring:
  profiles:
    group:
      production:
      - "proddb"
      - "prodmq"</pre>
</div>
</div>
<div class="paragraph">
<p>现在可以使用 --spring.profiles.active=production 来启动我们的应用程序，以便一次性激活production、proddb和prodmq配置文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_程序化设置profile"><a class="link" href="#_程序化设置profile">7.3.3. 程序化设置Profile</a></h4>
<div class="paragraph">
<p>你可以在应用运行前通过调用SpringApplication.setAdditionalProfiles(&#8230;&#8203;)以编程方式设置活动配置文件。也可以通过使用Spring的ConfigurableEnvironment接口来激活配置文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_特定的配置文件"><a class="link" href="#_特定的配置文件">7.3.4. 特定的配置文件</a></h4>
<div class="paragraph">
<p>application.properties（或application.yml）和通过@ConfigurationProperties引用的文件的特定配置文件变体都被视为文件并被加载。详见 "配置文件特定文件"。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_日志"><a class="link" href="#_日志">7.4. 日志</a></h3>
<div class="paragraph">
<p>Spring Boot在所有内部日志中使用Commons Logging，但对底层日志的实现保持开放。为Java Util Logging、Log4J2和Logback提供了默认配置。在每一种情况下，记录器都被预设为使用控制台输出，也可以选择文件输出。</p>
</div>
<div class="paragraph">
<p>默认情况下，如果你使用 "启动器"，Logback被用来做日志记录。适当的Logback路由也包括在内，以确保使用Java Util Logging、Commons Logging、Log4J或SLF4J的依赖库都能正确工作。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>有很多适用于Java的日志框架。如果上面的列表看起来很混乱，请不要担心。一般来说，你不需要改变你的日志依赖，Spring Boot的默认值就很好用。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>当你把你的应用程序部署到一个servlet容器或应用服务器时，用Java Util Logging API执行的日志不会被传送到你的应用程序的日志中。这可以防止由容器或其他已经部署到它的应用程序执行的日志出现在你的应用程序的日志中。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_日志格式"><a class="link" href="#_日志格式">7.4.1. 日志格式</a></h4>
<div class="paragraph">
<p>默认的日志格式是这样的</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2019-03-05 10:57:51.112  INFO 45469 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/7.0.52
2019-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2019-03-05 10:57:51.253  INFO 45469 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1358 ms
2019-03-05 10:57:51.698  INFO 45469 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: 'dispatcherServlet' to [/]
2019-03-05 10:57:51.702  INFO 45469 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]</pre>
</div>
</div>
<div class="paragraph">
<p>它包含以下内容的输出</p>
</div>
<div class="ulist">
<ul>
<li>
<p>日期和时间，精度为毫秒级，易于分类。</p>
</li>
<li>
<p>日志等级: ERROR, WARN, INFO, DEBUG, or TRACE.</p>
</li>
<li>
<p>进程ID</p>
</li>
<li>
<p>一个分隔符 ： ---</p>
</li>
<li>
<p>线程名称：包含在方括号中（为了控制台输出可能会被截断）。</p>
</li>
<li>
<p>记录仪名称：这通常是源类名称（通常是缩写）。</p>
</li>
<li>
<p>日志的内容</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>LogBack没有FAIL级别，它被映射到ERROR</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_控制台输出"><a class="link" href="#_控制台输出">7.4.2. 控制台输出</a></h4>
<div class="paragraph">
<p>默认的日志配置是在写信息的时候向控制台回音。默认情况下，ERROR级、WARN级和INFO级的信息被记录下来。你也可以通过用&#8212;&#8203;调试标志启动你的应用程序来启用 "DEBUG "模式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java -jar myapp.jar --debug</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你也可以在application.properties中指定debug = true</p>
</div>
</div>
</div>
<div class="paragraph">
<p>当调试模式被启用时，选择的核心记录器（嵌入式容器、Hibernate和Spring Boot）被配置为输出更多信息。启用调试模式并不能将你的应用程序配置为以DEBUG级别记录所有信息。</p>
</div>
<div class="paragraph">
<p>另外，你可以用&#8212;&#8203;trace标志（或在application.properties中的trace=true）来启动你的应用程序，启用 "跟踪 "模式。这样做可以为选定的核心记录器（嵌入式容器、Hibernate模式生成和整个Spring组合）实现跟踪记录。</p>
</div>
<div class="paragraph">
<p><strong>彩色编码的输出</strong></p>
</div>
<div class="paragraph">
<p>如果你的终端支持ANSI，就会使用彩色输出来帮助阅读。你可以将spring.output.ansi.enabled设置为一个支持的值来覆盖自动检测。</p>
</div>
<div class="paragraph">
<p>颜色编码是通过使用%clr转换词配置的。在其最简单的形式下，转换器根据日志级别对输出进行着色，如下例所示。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%clr(%5p)</pre>
</div>
</div>
<div class="paragraph">
<p>以下是各个级别对应的颜色</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">color</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAIL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yellow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRACE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>另外，你也可以通过为转换提供一个选项来指定应该使用的颜色或样式。例如，要使文本为黄色，请使用以下设置。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){yellow}</pre>
</div>
</div>
<div class="paragraph">
<p>以下是支持的颜色</p>
</div>
<div class="ulist">
<ul>
<li>
<p>blue</p>
</li>
<li>
<p>cyan</p>
</li>
<li>
<p>faint</p>
</li>
<li>
<p>green</p>
</li>
<li>
<p>magenta</p>
</li>
<li>
<p>red</p>
</li>
<li>
<p>yellow</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_文件输出"><a class="link" href="#_文件输出">7.4.3. 文件输出</a></h4>
<div class="paragraph">
<p>默认情况下，Spring Boot只向控制台记录日志，不写日志文件。如果你想在控制台输出之外写日志文件，你需要设置logging.file.name或logging.file.path属性（例如，在你的application.properties中）。</p>
</div>
<div class="paragraph">
<p>下表显示了logging.*属性如何被一起使用。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>logging.file.name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>loggingl.file.path</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>输出案例</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>描述</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">无</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">无</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">无</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅在控制台输出</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">my.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">无</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">my.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">写入指定的日志文件。名称可以是一个确切的位置，也可以是与当前目录的相对位置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">无</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/*.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">将spring.log写到指定目录。名称可以是准确的位置，也可以是与当前目录的相对位置。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>当日志文件达到10MB时就会轮换，与控制台输出一样，默认情况下记录ERROR级、WARN级和INFO级信息。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>日志属性独立于实际的日志基础设施。因此，特定的配置键（如Logback的logback.configurationFile）不由spring Boot管理。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_文件轮换"><a class="link" href="#_文件轮换">7.4.4. 文件轮换</a></h4>
<div class="paragraph">
<p>如果你使用Logback，可以使用你的application.properties或application.yaml文件来微调日志轮换设置。对于所有其他的日志系统，你需要自己直接配置轮换设置（例如，如果你使用Log4J2，那么你可以添加一个log4j2.xml或log4j2-spring.xml文件）。</p>
</div>
<div class="paragraph">
<p>支持以下轮换策略属性。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">描述</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.logback.rollingpolicy.file-name-pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用于创建日志档案的文件名模式。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.logback.rollingpolicy.clean-history-on-start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">如果应用程序启动时应进行日志归档清理。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.logback.rollingpolicy.max-file-size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日志文件归档前的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.logback.rollingpolicy.total-size-cap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">日志档案在被删除前的最大尺寸。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.logback.rollingpolicy.max-history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">要保留的归档日志文件的最大数量（默认为7）。</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_日志等级"><a class="link" href="#_日志等级">7.4.5. 日志等级</a></h4>
<div class="paragraph">
<p>所有支持的日志系统都可以通过使用logging.level.&lt;logger-name&gt;=&lt;level&gt;在Spring环境中（例如，在application.properties中）设置日志器级别，其中级别是TRACE、DEBUG、INFO、WARN、ERROR、FATAL或OFF之一。根记录器可以通过使用logging.level.root进行配置。</p>
</div>
<div class="paragraph">
<p>下面的例子显示了application.properties中潜在的日志设置。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logging:
  level:
    root: "warn"
    org.springframework.web: "debug"
    org.hibernate: "error"</pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用环境变量来设置日志级别。例如，LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=DEBUG将设置org.springframework.web为DEBUG。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>上述方法只适用于包级日志。由于放松的绑定总是将环境变量转换为小写，所以不可能用这种方式为单个类配置日志。如果你需要为一个类配置日志，你可以使用SPRING_APPLICATION_JSON变量。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_日志组"><a class="link" href="#_日志组">7.4.6. 日志组</a></h4>
<div class="paragraph">
<p>能够将相关的日志记录器分组，以便同时对它们进行配置，这通常很有用。例如，你可能通常会改变所有Tomcat相关日志记录器的日志级别，但你不容易记住顶级包。</p>
</div>
<div class="paragraph">
<p>为了帮助解决这个问题，Spring Boot允许你在Spring环境中定义日志组。例如，你可以通过在application.properties中添加 "tomcat "组来定义它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logging:
  group:
    tomcat: "org.apache.catalina,org.apache.coyote,org.apache.tomcat"</pre>
</div>
</div>
<div class="paragraph">
<p>一旦定义，就可以用一行字来改变组中所有记录仪的级别。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logging:
  level:
    tomcat: "trace"</pre>
</div>
</div>
<div class="paragraph">
<p>Spring Boot包括以下预定义的日志组，可以开箱即用。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">组名称</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">包含的类</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">web</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.core.codec, org.springframework.http, org.springframework.web, org.springframework.boot.actuate.endpoint.web, org.springframework.boot.web.servlet.ServletContextInitializerBeans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.springframework.jdbc.core, org.hibernate.SQL, org.jooq.tools.LoggerListener</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_使用日志关闭回调"><a class="link" href="#_使用日志关闭回调">7.4.7. 使用日志关闭回调</a></h4>
<div class="paragraph">
<p>In order to release logging resources when your application terminates, a shutdown hook that will trigger log system cleanup when the JVM exits is provided. This shutdown hook is registered automatically unless your application is deployed as a war file. If your application has complex context hierarchies the shutdown hook may not meet your needs. If it does not, disable the shutdown hook and investigate the options provided directly by the underlying logging system. For example, Logback offers context selectors which allow each Logger to be created in its own context. You can use the logging.register-shutdown-hook property to disable the shutdown hook. Setting it to false will disable the registration. You can set the property in your application.properties or application.yaml file:</p>
</div>
<div class="paragraph">
<p>为了在你的应用程序终止时释放日志资源，我们提供了一个关机钩子，它将在JVM退出时触发日志系统清理。这个关机钩子是自动注册的，除非你的应用程序是以战争文件的形式部署。如果你的应用程序有复杂的上下文层次结构，关闭钩子可能无法满足你的需求。如果不能，请禁用关机钩子，并研究底层日志系统直接提供的选项。例如，Logback提供了上下文选择器，允许在其自身的上下文中创建每个记录器。你可以使用logging.register-shutdown-hook属性来禁用关机钩。将其设置为false将禁用注册。你可以在你的application.properties或application.yaml文件中设置该属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>logging:
  register-shutdown-hook: false</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_自定义日志配置"><a class="link" href="#_自定义日志配置">7.4.8. 自定义日志配置</a></h4>
<div class="paragraph">
<p>各种日志系统可以通过在classpath上包括适当的库来激活，并且可以通过在classpath的根部或在以下Spring环境属性指定的位置提供一个合适的配置文件来进一步定制：logging.config。</p>
</div>
<div class="paragraph">
<p>您可以通过使用 org.springframework.boot.logging.LoggingSystem 系统属性来强制 Spring Boot 使用特定的日志系统。该值应该是LoggingSystem实现的完全限定类名称。您还可以通过使用none的值来完全禁用Spring Boot的日志配置。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>由于日志是在创建ApplicationContext之前初始化的，所以不可能从Spring @Configuration文件中的@PropertySources控制日志。改变日志系统或完全停用它的唯一方法是通过系统属性。</p>
</div>
</div>
</div>
<div class="paragraph">
<p>根据你的日志系统，会加载以下文件。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">日志系统</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">配置文件</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logback</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logback-spring.xml, logback-spring.groovy, logback.xml, or logback.groovy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log4j2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log4j2-spring.xml or log4j2.xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK (Java Util Logging)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">logging.properties</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>在可能的情况下，我们建议你对你的日志配置使用-spring的变体（例如，logback-spring.xml而不是logback.xml）。如果你使用标准配置位置，Spring不能完全控制日志初始化。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>当从 "可执行的jar "中运行时，Java Util Logging有一些已知的类加载问题，会导致问题。如果可能的话，我们建议你在从 "可执行的jar "中运行时避免它。</p>
</div>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>详情请看原文档</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>所有支持的日志系统在解析其配置文件时都可以查阅系统属性。例子见spring-boot.jar中的默认配置。</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>如果你想在日志属性中使用占位符，你应该使用Spring Boot的语法而不是底层框架的语法。值得注意的是，如果你使用Logback，你应该使用:作为属性名称和其默认值之间的分隔符，而不是使用:-。</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>你可以只通过覆盖 LOG_LEVEL_PATTERN（或 Logback 的 logging.pattern.level）来向日志行添加 MDC 和其他临时内容。例如，如果你使用 logging.pattern.level=user:%X{user} %5p，那么默认的日志格式包含 "user "的 MDC 条目，如果它存在的话，如下例所示。</p>
</div>
<div class="literalblock">
<div class="content">
<pre>2019-08-30 12:30:04.031 user:someone INFO 22174 --- [  nio-8080-exec-0] demo.Controller
Handling authenticated request</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-31 16:41:47 +0800
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>